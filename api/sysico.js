var _0x50d67e=_0xc4e1;function _0x1d2b(){var _0x47cbc6=['/usr/trim/share/.restore','icon.bak','static','deskdata','statSync','路径安全验证失败','resolve','length','文件大小超过限制','pause','deskdata/sysico/目录不存在','748590dXDaZQ','push','5EMfPsh','isDirectory','chmodSync','writeHead','接收文件数据出错:','缺少iconId参数','请先备份图标','图标上传成功','70836fAEicd','http://','startsWith','/var/apps/trim.media/target','/usr/trim/www','application/json','icon.png','文件删除成功','existsSync','恢复默认图标失败:','copyFileSync','res','searchParams','5813126kTeDqp','get','文件不存在，无需删除','end','sysico','同步文件','/var/apps/','path','146274SRUjdf','280bZIalC','unlinkSync','content-length','error','icons','接收文件数据失败','服务器内部错误','3302LpOsly','url','缺少directory参数','iconId','图标同步完成，成功:\x20','writeFileSync','headers','同步图标失败:','图标写入失败','失败:','app','message','tow','host','trim','47482bzPrHE','TRIM_APPNAME','8728FEBbIk','126PjhwVK','exports','resume','join','482912jQqosh','directory','concat','env','备份图标失败:','stringify','/deskdata','10uXnHpa','530romkJN','访问被拒绝','未找到备份文件icon.bak','删除sysico文件失败:'];_0x1d2b=function(){return _0x47cbc6;};return _0x1d2b();}(function(_0x2f6f24,_0x4326b3){var _0x219fe7=_0xc4e1,_0xd7105f=_0x2f6f24();while(!![]){try{var _0x2a7385=parseInt(_0x219fe7(0x15a))/0x1*(-parseInt(_0x219fe7(0x13a))/0x2)+-parseInt(_0x219fe7(0x158))/0x3+parseInt(_0x219fe7(0x13c))/0x4*(-parseInt(_0x219fe7(0x149))/0x5)+-parseInt(_0x219fe7(0x123))/0x6*(-parseInt(_0x219fe7(0x124))/0x7)+parseInt(_0x219fe7(0x141))/0x8*(-parseInt(_0x219fe7(0x13d))/0x9)+-parseInt(_0x219fe7(0x148))/0xa*(parseInt(_0x219fe7(0x16f))/0xb)+-parseInt(_0x219fe7(0x162))/0xc*(-parseInt(_0x219fe7(0x12b))/0xd);if(_0x2a7385===_0x4326b3)break;else _0xd7105f['push'](_0xd7105f['shift']());}catch(_0x11434d){_0xd7105f['push'](_0xd7105f['shift']());}}}(_0x1d2b,0x7a6b9));let fs=require('fs'),path=require(_0x50d67e(0x122)),pathMappings={'deskdata':_0x50d67e(0x121)+(process[_0x50d67e(0x144)][_0x50d67e(0x13b)]||_0x50d67e(0x139))+'/shares/'+(process[_0x50d67e(0x144)][_0x50d67e(0x13b)]||_0x50d67e(0x139))+_0x50d67e(0x147),'fnw':_0x50d67e(0x166),'res':_0x50d67e(0x14d),'trimMedia':_0x50d67e(0x165)};function ensureDirectoryExists(_0x57ec0a){var _0x4760e4=_0x50d67e;fs[_0x4760e4(0x16a)](_0x57ec0a)||fs['mkdirSync'](_0x57ec0a,{'recursive':!0x0});}function isPathSafe(_0x334ca4,_0x51fe7b){var _0x3c7957=_0x50d67e,_0x51b65f=path[_0x3c7957(0x140)](pathMappings[_0x3c7957(0x16d)],_0x3c7957(0x137),_0x3c7957(0x14f),_0x3c7957(0x135),_0x3c7957(0x128));return path[_0x3c7957(0x153)](_0x334ca4)[_0x3c7957(0x164)](_0x51b65f);}function handleRestoreDefaultIcon(_0x29d1cc,_0xc2572,_0x1018ef){var _0x4035f0=_0x50d67e;try{var _0x3adb39,_0x21dc48,_0x5ae08b,_0x7ce29d,_0x1a76fc=new URL(_0x29d1cc['url'],_0x4035f0(0x163)+_0x29d1cc[_0x4035f0(0x131)]['host'])[_0x4035f0(0x16e)][_0x4035f0(0x170)](_0x4035f0(0x142));_0x1a76fc?isPathSafe(_0x3adb39=path[_0x4035f0(0x140)](pathMappings[_0x4035f0(0x16d)],_0x4035f0(0x137),_0x4035f0(0x14f),_0x4035f0(0x135),_0x4035f0(0x128),_0x1a76fc),_0x1018ef)?(_0x21dc48=_0x3adb39,_0x5ae08b=path['join'](_0x21dc48,_0x4035f0(0x14e)),_0x7ce29d=path['join'](_0x21dc48,_0x4035f0(0x168)),fs[_0x4035f0(0x16a)](_0x5ae08b)?(fs[_0x4035f0(0x16c)](_0x5ae08b,_0x7ce29d),fs[_0x4035f0(0x15c)](_0x7ce29d,0x1a4),_0xc2572[_0x4035f0(0x15d)](0xc8,{'Content-Type':'application/json'}),_0xc2572[_0x4035f0(0x172)](JSON['stringify']({'success':!0x0,'message':'默认图标已恢复'}))):(_0xc2572[_0x4035f0(0x15d)](0x194,{'Content-Type':_0x4035f0(0x167)}),_0xc2572[_0x4035f0(0x172)](JSON[_0x4035f0(0x146)]({'success':!0x1,'message':_0x4035f0(0x14b)})))):(_0xc2572[_0x4035f0(0x15d)](0x193,{'Content-Type':_0x4035f0(0x167)}),_0xc2572['end'](JSON[_0x4035f0(0x146)]({'success':!0x1,'message':_0x4035f0(0x14a)}))):(_0xc2572['writeHead'](0x190,{'Content-Type':'application/json'}),_0xc2572[_0x4035f0(0x172)](JSON[_0x4035f0(0x146)]({'success':!0x1,'message':_0x4035f0(0x12d)})));}catch(_0x192ac1){console[_0x4035f0(0x127)](_0x4035f0(0x16b),_0x192ac1),_0xc2572[_0x4035f0(0x15d)](0x1f4,{'Content-Type':_0x4035f0(0x167)}),_0xc2572[_0x4035f0(0x172)](JSON['stringify']({'success':!0x1,'message':'服务器内部错误','error':_0x192ac1[_0x4035f0(0x136)]}));}}function handleBackupIcon(_0x490b42,_0x5f3060,_0x4fe557){var _0x42ee75=_0x50d67e;try{var _0x2b0b10,_0x534c9d,_0x15ff46,_0x55d4f6=new URL(_0x490b42[_0x42ee75(0x12c)],'http://'+_0x490b42['headers'][_0x42ee75(0x138)])[_0x42ee75(0x16e)][_0x42ee75(0x170)]('directory');_0x55d4f6?(_0x2b0b10=path[_0x42ee75(0x140)](pathMappings[_0x42ee75(0x16d)],_0x42ee75(0x137),_0x42ee75(0x14f),_0x42ee75(0x135),_0x42ee75(0x128),_0x55d4f6),_0x534c9d=path['join'](_0x2b0b10,_0x42ee75(0x168)),_0x15ff46=path[_0x42ee75(0x140)](_0x2b0b10,_0x42ee75(0x14e)),fs[_0x42ee75(0x16a)](_0x534c9d)?(fs[_0x42ee75(0x16a)](_0x15ff46)||(fs['copyFileSync'](_0x534c9d,_0x15ff46),fs[_0x42ee75(0x15c)](_0x15ff46,0x1a4)),ensureDirectoryExists(path[_0x42ee75(0x140)](pathMappings[_0x42ee75(0x150)],_0x42ee75(0x11f))),_0x5f3060[_0x42ee75(0x15d)](0xc8,{'Content-Type':_0x42ee75(0x167)}),_0x5f3060[_0x42ee75(0x172)](JSON['stringify']({'success':!0x0,'message':'图标备份完成，可以上传新图标'}))):(_0x5f3060[_0x42ee75(0x15d)](0x194,{'Content-Type':'application/json'}),_0x5f3060[_0x42ee75(0x172)](JSON['stringify']({'success':!0x1,'message':'未找到原始图标文件icon.png'})))):(_0x5f3060[_0x42ee75(0x15d)](0x190,{'Content-Type':_0x42ee75(0x167)}),_0x5f3060[_0x42ee75(0x172)](JSON['stringify']({'success':!0x1,'message':_0x42ee75(0x12d)})));}catch(_0x5b1fe6){console[_0x42ee75(0x127)](_0x42ee75(0x145),_0x5b1fe6),_0x5f3060[_0x42ee75(0x15d)](0x1f4,{'Content-Type':_0x42ee75(0x167)}),_0x5f3060[_0x42ee75(0x172)](JSON['stringify']({'success':!0x1,'message':'服务器内部错误','error':_0x5b1fe6[_0x42ee75(0x136)]}));}}function handleUploadIcon(_0x1f6605,_0x500068,_0x3bc78f){var _0x56badd=_0x50d67e;try{let _0x2abc49=new URL(_0x1f6605[_0x56badd(0x12c)],_0x56badd(0x163)+_0x1f6605[_0x56badd(0x131)]['host'])[_0x56badd(0x16e)][_0x56badd(0x170)](_0x56badd(0x142));if(_0x2abc49){var _0x497bbf=path[_0x56badd(0x140)](pathMappings[_0x56badd(0x16d)],_0x56badd(0x137),_0x56badd(0x14f),_0x56badd(0x135),'icons',_0x2abc49);if(isPathSafe(_0x497bbf,_0x3bc78f)){var _0x2acc84=_0x497bbf;let _0x590a69=path[_0x56badd(0x140)](_0x2acc84,_0x56badd(0x168));var _0x184c78=path[_0x56badd(0x140)](_0x2acc84,_0x56badd(0x14e));if(fs[_0x56badd(0x16a)](_0x184c78)){_0x1f6605[_0x56badd(0x156)]();let _0x446567=[];parseInt(_0x1f6605[_0x56badd(0x131)][_0x56badd(0x126)]||0x0);let _0x3ac59b=0x0;_0x1f6605[_0x56badd(0x13f)](),_0x1f6605['on']('data',_0x909f93=>{var _0x352f61=_0x56badd;_0x3ac59b+=_0x909f93[_0x352f61(0x154)],_0x446567[_0x352f61(0x159)](_0x909f93),0xa00000<_0x3ac59b&&_0x1f6605['destroy'](new Error(_0x352f61(0x155)));}),_0x1f6605['on'](_0x56badd(0x172),()=>{var _0x5813ab=_0x56badd;try{var _0x4237db=Buffer[_0x5813ab(0x143)](_0x446567),_0x50416c=path[_0x5813ab(0x140)](pathMappings['deskdata'],_0x5813ab(0x11f)),_0x1118ff=(ensureDirectoryExists(_0x50416c),path[_0x5813ab(0x140)](_0x50416c,''+_0x2abc49));fs[_0x5813ab(0x130)](_0x1118ff,_0x4237db),fs['chmodSync'](_0x1118ff,0x1a4),fs[_0x5813ab(0x16c)](_0x1118ff,_0x590a69),fs[_0x5813ab(0x15c)](_0x590a69,0x1a4),_0x500068[_0x5813ab(0x15d)](0xc8,{'Content-Type':_0x5813ab(0x167)}),_0x500068[_0x5813ab(0x172)](JSON[_0x5813ab(0x146)]({'success':!0x0,'message':_0x5813ab(0x161)}));}catch(_0x2560f4){console[_0x5813ab(0x127)]('写入图标文件失败:',_0x2560f4),_0x500068[_0x5813ab(0x15d)](0x1f4,{'Content-Type':_0x5813ab(0x167)}),_0x500068['end'](JSON[_0x5813ab(0x146)]({'success':!0x1,'message':_0x5813ab(0x133),'error':_0x2560f4[_0x5813ab(0x136)]}));}}),_0x1f6605['on'](_0x56badd(0x127),_0x12c408=>{var _0xdb3af4=_0x56badd;console[_0xdb3af4(0x127)](_0xdb3af4(0x15e),_0x12c408),_0x500068[_0xdb3af4(0x15d)](0x1f4,{'Content-Type':_0xdb3af4(0x167)}),_0x500068[_0xdb3af4(0x172)](JSON[_0xdb3af4(0x146)]({'success':!0x1,'message':_0xdb3af4(0x129),'error':_0x12c408[_0xdb3af4(0x136)]}));});}else _0x500068[_0x56badd(0x15d)](0x190,{'Content-Type':_0x56badd(0x167)}),_0x500068[_0x56badd(0x172)](JSON[_0x56badd(0x146)]({'success':!0x1,'message':_0x56badd(0x160)}));}else _0x500068[_0x56badd(0x15d)](0x193,{'Content-Type':_0x56badd(0x167)}),_0x500068['end'](JSON[_0x56badd(0x146)]({'success':!0x1,'message':_0x56badd(0x14a)}));}else _0x500068[_0x56badd(0x15d)](0x190,{'Content-Type':_0x56badd(0x167)}),_0x500068[_0x56badd(0x172)](JSON['stringify']({'success':!0x1,'message':_0x56badd(0x12d)}));}catch(_0x4b6b37){console[_0x56badd(0x127)]('上传图标失败:',_0x4b6b37),_0x500068[_0x56badd(0x15d)](0x1f4,{'Content-Type':_0x56badd(0x167)}),_0x500068[_0x56badd(0x172)](JSON[_0x56badd(0x146)]({'success':!0x1,'message':'服务器内部错误','error':_0x4b6b37['message']}));}}function syncIcons(_0x27cca9,_0xf3a80b,_0x3d7b9a){var _0x4be9b7=_0x50d67e;try{let _0x20aca1=path['join'](pathMappings['deskdata'],'sysico');if(fs['existsSync'](_0x20aca1)){var _0x15a408=fs['readdirSync'](_0x20aca1);let _0x284019=[],_0x2fb3e8=[];_0x15a408['forEach'](_0x156f25=>{var _0x5373bd=_0xc4e1;try{var _0x1eb91e,_0x69ee38,_0x497ca2,_0x4f84c7,_0x122042=path['join'](_0x20aca1,_0x156f25);fs[_0x5373bd(0x151)](_0x122042)[_0x5373bd(0x15b)]()||(isPathSafe(_0x1eb91e=path[_0x5373bd(0x140)](pathMappings[_0x5373bd(0x16d)],_0x5373bd(0x137),_0x5373bd(0x14f),_0x5373bd(0x135),_0x5373bd(0x128),_0x156f25),_0x3d7b9a)?(_0x69ee38=_0x1eb91e,_0x497ca2=path[_0x5373bd(0x140)](_0x69ee38,_0x5373bd(0x168)),_0x4f84c7=path[_0x5373bd(0x140)](_0x69ee38,_0x5373bd(0x14e)),ensureDirectoryExists(_0x69ee38),!fs['existsSync'](_0x4f84c7)&&fs[_0x5373bd(0x16a)](_0x497ca2)&&(fs[_0x5373bd(0x16c)](_0x497ca2,_0x4f84c7),fs['chmodSync'](_0x4f84c7,0x1a4)),fs[_0x5373bd(0x16c)](_0x122042,_0x497ca2),fs['chmodSync'](_0x497ca2,0x1a4),_0x284019[_0x5373bd(0x159)](_0x156f25)):_0x2fb3e8['push']({'filename':_0x156f25,'reason':_0x5373bd(0x152)}));}catch(_0x4e90a9){console[_0x5373bd(0x127)](_0x5373bd(0x120)+_0x156f25+_0x5373bd(0x134),_0x4e90a9),_0x2fb3e8[_0x5373bd(0x159)]({'filename':_0x156f25,'reason':_0x4e90a9[_0x5373bd(0x136)]});}}),_0xf3a80b[_0x4be9b7(0x15d)](0xc8,{'Content-Type':_0x4be9b7(0x167)}),_0xf3a80b[_0x4be9b7(0x172)](JSON[_0x4be9b7(0x146)]({'success':!0x0,'message':_0x4be9b7(0x12f)+_0x284019[_0x4be9b7(0x154)]+',\x20失败:\x20'+_0x2fb3e8['length'],'successFiles':_0x284019,'failedFiles':_0x2fb3e8}));}else _0xf3a80b['writeHead'](0x194,{'Content-Type':_0x4be9b7(0x167)}),_0xf3a80b['end'](JSON['stringify']({'success':!0x1,'message':_0x4be9b7(0x157)}));}catch(_0x31b891){console['error'](_0x4be9b7(0x132),_0x31b891),_0xf3a80b[_0x4be9b7(0x15d)](0x1f4,{'Content-Type':_0x4be9b7(0x167)}),_0xf3a80b[_0x4be9b7(0x172)](JSON['stringify']({'success':!0x1,'message':_0x4be9b7(0x12a),'error':_0x31b891[_0x4be9b7(0x136)]}));}}function handleDeleteSysicoFile(_0xd61b04,_0x4459e1,_0x27cec){var _0xb10e2e=_0x50d67e;try{var _0x5b4974,_0x2b2a20=new URL(_0xd61b04[_0xb10e2e(0x12c)],_0xb10e2e(0x163)+_0xd61b04[_0xb10e2e(0x131)][_0xb10e2e(0x138)])['searchParams'][_0xb10e2e(0x170)](_0xb10e2e(0x12e));_0x2b2a20?(_0x5b4974=path[_0xb10e2e(0x140)](pathMappings['deskdata'],_0xb10e2e(0x11f),_0x2b2a20),fs[_0xb10e2e(0x16a)](_0x5b4974)?(fs[_0xb10e2e(0x125)](_0x5b4974),_0x4459e1['writeHead'](0xc8,{'Content-Type':_0xb10e2e(0x167)}),_0x4459e1[_0xb10e2e(0x172)](JSON['stringify']({'success':!0x0,'message':_0xb10e2e(0x169)}))):(_0x4459e1[_0xb10e2e(0x15d)](0xc8,{'Content-Type':'application/json'}),_0x4459e1['end'](JSON[_0xb10e2e(0x146)]({'success':!0x0,'message':_0xb10e2e(0x171)})))):(_0x4459e1[_0xb10e2e(0x15d)](0x190,{'Content-Type':'application/json'}),_0x4459e1['end'](JSON[_0xb10e2e(0x146)]({'success':!0x1,'message':_0xb10e2e(0x15f)})));}catch(_0x4c3b1e){console['error'](_0xb10e2e(0x14c),_0x4c3b1e),_0x4459e1[_0xb10e2e(0x15d)](0x1f4,{'Content-Type':_0xb10e2e(0x167)}),_0x4459e1['end'](JSON['stringify']({'success':!0x1,'message':_0x4c3b1e[_0xb10e2e(0x136)]}));}}function _0xc4e1(_0xc76a5c,_0x569748){var _0x1d2ba4=_0x1d2b();return _0xc4e1=function(_0xc4e1e3,_0x2d4bb5){_0xc4e1e3=_0xc4e1e3-0x11f;var _0x4df007=_0x1d2ba4[_0xc4e1e3];return _0x4df007;},_0xc4e1(_0xc76a5c,_0x569748);}module[_0x50d67e(0x13e)]={'handleRestoreDefaultIcon':handleRestoreDefaultIcon,'handleBackupIcon':handleBackupIcon,'handleUploadIcon':handleUploadIcon,'syncIcons':syncIcons,'handleDeleteSysicoFile':handleDeleteSysicoFile};