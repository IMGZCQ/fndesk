(p=>{var i=localStorage.repeat||0,r=localStorage.shuffle||"false",a=!0,t=!0,y=[],h=!1,d=parseInt(localStorage.lyricsDisplayMode||0),l=JSON.parse(localStorage.playbackPositions||"{}"),n=parseInt(localStorage.lastPlayedTrack||-1),s="true"===localStorage.shouldAutoResume,c=[],o={},u={};function loadBasicPlaylist(e){c=[];for(let t=0;t<e.length;t++){var i=e[t],r=function extractFileNameFromPath(t){t=t.split(/[\\/]/).pop();return t}(i),a="/app-center-static/serviceicon/fndesk/MP3/"+i,a={title:function getFileNameWithoutExtension(t){return t.replace(/\.(mp3|wav|flac|aac|ogg|wma|m4a|aif|aiff)$/i,"")}(r),artist:"Êú™Áü•Ëâ∫ÊúØÂÆ∂",album:"Êú™Áü•‰∏ìËæë",picture:null,audioUrl:a,extension:r.split(".").pop().toLowerCase(),fullPath:i,directory:function getFileDirectory(t){t=t.split(/[\\/]/);return t.pop(),t.join("/")}(i)};c.push(a)}!function loadPlaylistToPage(){p("#playlist").empty(),function renderDirectoryStructure(e,t,l){let i=e.files.length;Object.keys(e.children).forEach(t=>{i+=countFilesInDirectory(e.children[t])});let r=0<Object.keys(e.children).length||0<e.files.length;let a=getDirectoryId(e);let n="&nbsp;".repeat(4*l);let s=p(`<li class="directory-item" data-dir-id="${a}" data-dir-type="${e.type}" data-dir-path="${e.path}" style="padding-left: 0;">
			${n}<span class="dir-toggle" style="display: inline-block; width: 20px; cursor: pointer; text-align: center;">${r?"‚ïã":""}</span>
			<span class="dir-name">${e.name} (${i})</span>
			${0<i?'<span class="dir-play-btn" style="margin-left: 10px; cursor: pointer; color: #4CAF50;">‚ñ∂</span>':""}
		</li>`);t.append(s);let o=p(`<ul class="dir-children" id="${a}-children" style="list-style: none; padding-left: 0; display: none;"></ul>`);t.append(o);e.files.forEach(r=>{let a=c[r.index];if(a){let t="&nbsp;".repeat(4*(l+1)),e=a.artist&&"Êú™Áü•Ëâ∫ÊúØÂÆ∂"!==a.artist?a.artist+" - "+a.title:a.title,i=p(`<li class="file-item" data-index="${r.index}" style="cursor: pointer; padding-left: 0;">
					${t}üéµ ${e}
				</li>`);o.append(i)}});Object.keys(e.children).sort().forEach(t=>{renderDirectoryStructure(e.children[t],o,l+1)});"root"===e.type&&(o.show(),r)&&s.find(".dir-toggle").text("‚îÅ")}(u,p("#playlist"),0),function bindPlaylistClick(){p("#playlist").off("click",".directory-item .dir-toggle").on("click",".directory-item .dir-toggle",function(t){t.stopPropagation(),toggleDirectory(p(this))}),p("#playlist").off("click",".directory-item .dir-name").on("click",".directory-item .dir-name",function(t){t.stopPropagation(),toggleDirectory(p(this).siblings(".dir-toggle"))}),p("#playlist").off("dblclick",".directory-item").on("dblclick",".directory-item",function(t){t.stopPropagation();var t=p(this),e=t.data("dir-type"),t=t.data("dir-path");"root"===e?playDirectorySongs(u):(e=function findDirectoryByPath(e,i){if(e.path===i)return e;for(var r in e.children){let t=findDirectoryByPath(e.children[r],i);if(t)return t}return null}(u,t))&&playDirectorySongs(e)}),p("#playlist").off("click",".file-item").on("click",".file-item",function(){var t=p(this).data("index");E(parseInt(t))})}()}(),0<c.length&&function resumePlaybackIfNeeded(){if(0<=n&&n<c.length){var t=c[n],e=t?l[t.audioUrl]:void 0;if(void 0!==e)return l[t.audioUrl]=e,g=n,setTimeout(()=>{N(n),s&&setTimeout(()=>{U()},500)},100)}var i=JSON.parse(localStorage.playbackPositions||"{}"),t=Object.keys(i);if(0<t.length){var r=t[0];i[r];let e=-1;for(let t=0;t<c.length;t++)if(c[t].audioUrl===r){l=i,g=t,setTimeout(()=>{N(t),s&&setTimeout(()=>{U()},500)},100),e=t;break}if(-1===e)for(let t=0;t<c.length;t++)if(c[t].audioUrl===r){l=i,g=t,setTimeout(()=>{N(t),s&&setTimeout(()=>{U()},500)},100);break}}else 0<c.length&&(g=0,setTimeout(()=>{N(0),s&&setTimeout(()=>{U()},500)},100))}()}function getDirectoryId(t){return"root"===t.type?"root-directory":"dir-"+t.path.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g,"-")}function countFilesInDirectory(e){let i=e.files.length;return Object.keys(e.children).forEach(t=>{i+=countFilesInDirectory(e.children[t])}),i}function loadSingleAudioMetadata(a,l=!1){if(o[a])return l&&updateNowPlayingInfo(a),Promise.resolve();let n=c[a];return n?(o[a]=!0,new Promise(r=>{"flac"===n.extension?function loadFlacMetadata(r,a,l,n){fetch(r.audioUrl).then(t=>{if(t.ok)return t.arrayBuffer();throw new Error("Network response was not ok")}).then(t=>{try{var e=function parseFlacMetadata(t){let e=new DataView(t),i=0;if(1716281667!==e.getUint32(0))throw new Error("Not a valid FLAC file");i=4;var r={title:null,artist:null,album:null,lyrics:null,picture:null};for(;i<t.byteLength;){var a=e.getUint32(i),l=(i+=4,0!=(2147483648&a)),n=(2130706432&a)>>24,a=16777215&a;if(4==n){var s=function parseVorbisComment(e){let i=0,r={},t=readUint32LittleEndian(e,i);i+=4+t;var a=readUint32LittleEndian(e,i);i+=4;for(let t=0;t<a&&!(i>=e.length);t++){var l=readUint32LittleEndian(e,i);if((i+=4)+l>e.length)break;var n,s=decodeUTF8(e.slice(i,i+l)),l=(i+=l,s.indexOf("="));-1!==l&&(n=s.substring(0,l),s=s.substring(l+1),r[n.toUpperCase()]=s)}return r}(new Uint8Array(t,i,a));r.title=s.TITLE||s.Title||s.title||r.title,r.artist=s.ARTIST||s.Artist||s.artist||r.artist,r.album=s.ALBUM||s.Album||s.album||r.album,r.lyrics=s.LYRICS||s.Lyrics||s.lyrics||s.UNSYNCEDLYRICS||s.UnsyncedLyrics||s.unsyncedlyrics||s.UNSYNCHRONISEDLYRICS||s.UnsynchronisedLyrics||s.unsynchronisedlyrics||r.lyrics}else if(6==n)try{var o=new Uint8Array(t,i,a);r.picture=function parsePictureBlock(t){let e=0,i=readUint32BigEndian(t,0),r=readUint32BigEndian(t,e+=4),a=(e+=4,function decodeASCII(e){let i="";for(let t=0;t<e.length;t++)i+=String.fromCharCode(e[t]);return i}(t.slice(8,8+r))),l=readUint32BigEndian(t,e+=r),n=(e+=4,decodeUTF8(t.slice(e,e+l))),s=readUint32BigEndian(t,e+=l),o=readUint32BigEndian(t,e+=4),c=(readUint32BigEndian(t,e+=4),readUint32BigEndian(t,e+=4),readUint32BigEndian(t,e+=4)),d=(e+=4,t.slice(e,e+c));return{format:a,data:d,type:i,description:n,width:s,height:o}}(o)}catch(t){}if(i+=a,l)break}return r}(t),i=r.title;r.title=e.title||i,r.artist=e.artist||"Êú™Áü•Ëâ∫ÊúØÂÆ∂",r.album=e.album||"Êú™Áü•‰∏ìËæë",r.lyrics=e.lyrics||null,r.picture=e.picture||null,l&&updateNowPlayingInfo(a),updatePlaylistItemDisplay(a),n()}catch(t){l&&updateNowPlayingInfo(a),o[a]=!0,n()}}).catch(t=>{l&&updateNowPlayingInfo(a),o[a]=!0,n()})}(n,a,l,r):"undefined"==typeof jsmediatags?(l&&updateNowPlayingInfo(a),r()):fetch(n.audioUrl).then(t=>{if(t.ok)return t.blob();throw new Error("Network response was not ok")}).then(t=>{jsmediatags.read(t,{tags:["title","artist","album","picture","lyrics","LYRICS","Lyrics","USLT","unsynchronised lyrics","Unsynchronised Lyrics"],onSuccess:function(t){var e=n.title;if(n.title=t.tags.title||e,n.artist=t.tags.artist||"Êú™Áü•Ëâ∫ÊúØÂÆ∂",n.album=t.tags.album||"Êú™Áü•‰∏ìËæë",n.picture=t.tags.picture,n.lyrics=t.tags.lyrics||t.tags.LYRICS||t.tags.Lyrics||t.tags.USLT||t.tags["unsynchronised lyrics"]||t.tags["Unsynchronised Lyrics"]||null,!n.lyrics&&t.tags.USLT&&"object"==typeof t.tags.USLT&&(t.tags.USLT.text?n.lyrics=t.tags.USLT.text:t.tags.USLT.data&&(n.lyrics=t.tags.USLT.data)),!n.lyrics)for(var i in t.tags)if(t.tags.hasOwnProperty(i)){i=t.tags[i];if(i&&"object"==typeof i&&(i.text||i.data)){i=i.text||i.data;if("string"==typeof i&&50<i.length){n.lyrics=i;break}}}l&&updateNowPlayingInfo(a),updatePlaylistItemDisplay(a),r()},onError:function(t){l&&updateNowPlayingInfo(a),o[a]=!0,r()}})}).catch(t=>{l&&updateNowPlayingInfo(a),o[a]=!0,r()})})):Promise.resolve()}function readUint32BigEndian(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function readUint32LittleEndian(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function decodeUTF8(t){let e="",i=0;for(;i<t.length;){var r,a,l=t[i++];l<128?e+=String.fromCharCode(l):192<=l&&l<224?(r=63&t[i++],e+=String.fromCharCode((31&l)<<6|r)):224<=l&&l<240?(r=63&t[i++],a=63&t[i++],e+=String.fromCharCode((15&l)<<12|r<<6|a)):240<=l&&l<248&&(a=(7&l)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++],a-=65536,e+=String.fromCharCode(55296+(a>>10),56320+(1023&a)))}return e}function updateNowPlayingInfo(t){var i=c[t];if(i){if(i.picture)if(i.picture.format&&i.picture.data)try{let e="";if(i.picture.data instanceof Uint8Array){var r=i.picture.data.byteLength;for(let t=0;t<r;t++)e+=String.fromCharCode(i.picture.data[t])}else{if(!Array.isArray(i.picture.data))throw new Error("Unsupported picture data format");for(let t=0;t<i.picture.data.length;t++)e+=String.fromCharCode(i.picture.data[t])}let t="data:"+i.picture.format+";base64,"+btoa(e);p(".cover").html('<img src="'+t+'" alt="'+i.album+'">')}catch(t){p(".cover").html('<div class="no-cover">'+i.title+"</div>")}else try{for(var e="",a=0;a<i.picture.data.length;a++)e+=String.fromCharCode(i.picture.data[a]);var l="data:"+i.picture.format+";base64,"+window.btoa(e);p(".cover").html('<img src="'+l+'" alt="'+i.album+'">')}catch(t){p(".cover").html('<div class="no-cover">'+i.title+"</div>")}else p(".cover").html('<div class="no-cover">'+i.title+"</div>");p(".tag").html("<strong>"+i.title+'</strong><span class="artist">'+i.artist+'</span><span class="album">'+i.album+"</span>"),!function highlightCurrentSongDirectory(t){t=c[t];if(t){if(p("#playlist .directory-item").removeClass("current-dir"),t.directory){var i=t.directory.split(/[\\/]/);let e="";for(let t=0;t<i.length;t++){0<t&&(e+="/"),e+=i[t];var r=p(`.directory-item[data-dir-path="${e}"]`);0<r.length&&r.addClass("current-dir")}}p('.directory-item[data-dir-type="root"]').addClass("current-dir")}}(t)}}function updatePlaylistItemDisplay(t){var e=c[t];e&&(e=e.artist&&"Êú™Áü•Ëâ∫ÊúØÂÆ∂"!==e.artist?e.artist+" - "+e.title:e.title,p(`#playlist .file-item[data-index="${t}"]`).html("&nbsp;".repeat(4*function getItemIndentLevel(t){t=c[t];if(!t)return 0;t=t.directory?t.directory.split(/[\\/]/):[];return t.length+1}(t))+"üéµ "+e))}function toggleDirectory(t){var e=t.closest(".directory-item").data("dir-id"),e=p("#"+e+"-children");e.is(":visible")?(e.hide(),t.text("‚ïã")):(e.show(),t.text("‚îÅ")),adjustPlaylistHeight()}function adjustPlaylistHeight(){let e=p("#playlist");e.is(":visible")&&setTimeout(function(){var t=130;t+=e[0].scrollHeight,t=Math.min(t,500),window.parent.postMessage({type:"adjustMP3PlayerHeight",height:t},"*")},50)}function playDirectorySongs(t){t=function collectSongIndices(e){let i=[];e.files.forEach(t=>{i.push(t.index)});Object.keys(e.children).forEach(t=>{i=i.concat(collectSongIndices(e.children[t]))});return i}(t);0<t.length&&(x=t.map(t=>c[t]),E((C=t)[0],!0))}document.addEventListener("DOMContentLoaded",function(){!function checkLoginStatus(){var t="true"===localStorage.getItem("musicPlayerAuthenticated"),e=localStorage.getItem("musicPlayerAuthExpiration");t&&e?(t=new Date(e),e=new Date,t<=e?(localStorage.removeItem("musicPlayerAuthenticated"),localStorage.removeItem("musicPlayerAuthExpiration"),window.location.href="login.html"):("true"===localStorage.getItem("musicPlayerNoPasswordMode")&&p(".logout").hide(),function initPlayer(){!function scanAudioDirectory(){fetch("/app-center-static/serviceicon/fndesk/MP3.json").then(t=>{if(t.ok)return t.json();throw new Error("Network response was not ok")}).then(t=>{!function buildDirectoryStructure(i){u={name:"ÂÖ®ÈÉ®Ê≠åÊõ≤",type:"root",path:"",children:{},files:[]};for(let t=0;t<i.length;t++){var r=i[t].split(/[\\/]/);let e=u;for(let t=0;t<r.length-1;t++){var a=r[t],l=function getPathToDirectory(t,e){return""!==t.path?t.path+"/"+e:e}(e,a);e.children[a]||(e.children[a]={name:a,type:"directory",path:l,parent:e,children:{},files:[]}),e=e.children[a]}e.files.push({index:t,name:r[r.length-1]})}}(t),loadBasicPlaylist(t)}).catch(t=>{loadBasicPlaylist([])})}()}())):window.location.href="login.html"}()}),new Date;var g=0,f=null,m=null,v=!1,e=null,b=0,S=0,x=null,C=null,w=!1,k=!1,P=0,I=3,U=function(){var t;f?(t=f.play(),startStallDetection(),void 0!==t?t.then(function(){p(".playback").addClass("playing"),m=setInterval(L,500),v=!0,localStorage.shouldAutoResume="true",P=0}).catch(function(t){p(".playback").removeClass("playing"),v=!1,I<=++P&&function showErrorMessage(t){let e=p("#error-message");0===e.length&&(e=p('<div id="error-message" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: #ff5555; padding: 20px; border-radius: 10px; z-index: 9999; text-align: center; box-shadow: 0 0 20px rgba(255,0,0,0.5);"></div>'),p("body").append(e));e.html(t),e.show(),setTimeout(()=>{e.fadeOut()},3e3)}("ËøûÁª≠Êí≠ÊîæÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂ÊàñÊâãÂä®ÈÄâÊã©ÂÖ∂‰ªñÊ≠åÊõ≤")}):(p(".playback").addClass("playing"),m=setInterval(L,500),v=!0,localStorage.shouldAutoResume="true")):startStallDetection()},D=function(){f&&(f.pause(),p(".playback").removeClass("playing"),clearInterval(m),v=!1,localStorage.shouldAutoResume="false",stopStallDetection())};function startStallDetection(){S=b=0,k=!1,e=setInterval(checkStall,1e4)}function stopStallDetection(){e&&(clearInterval(e),e=null),k=!0}function checkStall(){w||k||f&&v&&(f.currentTime===b?3<=++S&&(stopStallDetection(),P=0,"true"===r?j():E(++g)):(S=0,b=f.currentTime,P=0))}function G(t){var e,i,r,a;f&&(e=parseInt(t/60),i=parseInt(t%60)<10?"0"+parseInt(t%60):parseInt(t%60),r=parseInt(f.duration/60),a=parseInt(f.duration%60)<10?"0"+parseInt(f.duration%60):parseInt(f.duration%60),t=t/f.duration*100)&&isFinite(t)&&(p(".timer").html(e+":"+i+" / "+r+":"+a),p(".progress .pace").css("width",t+"%"),p(".progress .slider a").css("left",t+"%"))}function J(t){f&&(f.volume=localStorage.volume=t),p(".volume .pace").css("width",100*t+"%"),p(".volume .slider a").css("left",100*t+"%")}var L=function(){if(!p(".progress .slider").hasClass("enable")&&f&&(G(f.currentTime),updateLyricsDisplay(f.currentTime),Math.floor(f.currentTime)%5==0)){var t=c[g];if(t&&10<f.currentTime){l[t.audioUrl]=f.currentTime;try{localStorage.playbackPositions=JSON.stringify(l),localStorage.lastPlayedTrack=g}catch(t){}}}},T=(p(".progress .slider").slider({step:.1,slide:function(t,e){f&&(p(this).addClass("enable"),G(f.duration*e.value/100),clearInterval(m))},stop:function(t,e){f&&f.duration&&isFinite(f.duration)&&(e=f.duration*e.value/100,isFinite(e)&&(f.currentTime=e),p(this).removeClass("enable"),m=setInterval(L,500))}}),localStorage.volume||.5),E=(p(".volume .slider").slider({max:1,min:0,step:.01,value:T,slide:function(t,e){J(e.value),p(this).addClass("enable"),p(".mute").removeClass("enable")},stop:function(){p(this).removeClass("enable")}}).children(".pace").css("width",100*T+"%"),p(".mute").click(function(){f&&(p(this).hasClass("enable")?(J(p(this).data("volume")),p(this).removeClass("enable")):(p(this).data("volume",f.volume).addClass("enable"),J(0)))}),function(t,e=!1){w=!0;var i=e&&x?x:c;track=t<0?g=i.length-1:t>=i.length?g=0:t,f&&(f.pause(),f.removeEventListener("error",M),f=null),p("audio").remove(),N(track,e),1==v&&U(),w=!1}),j=function(){var t=x||c,e=new Date;g==(g=e.getTime()%t.length)&&++g,E(g,!!x)},H=function(){D(),f&&(f.currentTime=0),1==a&&(v=!0);var t=c[g];if(t){delete l[t.audioUrl];try{localStorage.playbackPositions=JSON.stringify(l);var e=(g+1)%c.length;localStorage.lastPlayedTrack=e}catch(t){}}1==i?U():"true"===r?j():(2==i||g<(x||c).length)&&E(++g,!!x)},A=function(){var t=this.seekable&&this.seekable.length?this.seekable.end(0):0;p(".progress .loaded").css("width",100/(this.duration||1)*t+"%")},$=function(){1==t&&U()},M=function(){stopStallDetection(),f&&(f.removeEventListener("error",M),f=null),"true"===r?j():E(++g,!!x)},N=function(t,e=!1){let i=e&&x?x:c;var r=e&&C?C[t]:t,a=i[t];a&&(stopStallDetection(),g=t,p(".cover").html('<div class="no-cover">'+a.title+"</div>"),p(".tag").html("<strong>"+a.title+'</strong><span class="artist">'+a.artist+'</span><span class="album">'+a.album+"</span>"),p("#playlist .file-item").removeClass("playing"),(e?(e=C?C[t]:t,p(`#playlist .file-item[data-index="${e}"]`)):p(`#playlist .file-item[data-index="${r}"]`)).addClass("playing"),function scrollToCurrentSong(t){let l=p(`#playlist .file-item[data-index="${t}"]`);0<l.length&&(!function expandParentDirectories(t){t=c[t];if(t&&t.directory){var i=t.directory.split(/[\\/]/);let e="";for(let t=0;t<i.length;t++){0<t&&(e+="/"),e+=i[t];var r,a=p(`.directory-item[data-dir-path="${e}"]`);0<a.length&&(r=a.data("dir-id"),r=p("#"+r+"-children"),a=a.find(".dir-toggle"),r.is(":visible")||(r.show(),a.text("‚îÅ")))}var t=p('.directory-item[data-dir-type="root"]'),l=t.data("dir-id"),l=p("#"+l+"-children"),t=t.find(".dir-toggle");l.is(":visible")||(l.show(),t.text("‚îÅ"))}}(t),setTimeout(()=>{var t=p("#playlist"),e=t.scrollTop(),i=t.height(),r=l.position().top,a=l.outerHeight();(r<0||i<r+a)&&t.animate({scrollTop:e+r-i/2},300),adjustPlaylistHeight()},350))}(r),loadSingleAudioMetadata(r,!0).then(()=>{!function loadLyrics(i){var t;y=[],h=!1,p(".lyrics-line").empty(),i.lyrics?(parseAndDisplayLyrics(i.lyrics),adjustPlayerHeight()):(t=i.audioUrl.replace(/\.[^\.]+$/,".lrc"),fetch(t).then(t=>{if(t.ok)return t.text();throw new Error("LRCÊñá‰ª∂‰∏çÂ≠òÂú®")}).then(t=>{parseAndDisplayLyrics(t)}).catch(t=>{var e=i.audioUrl.replace(/\.[^\.]+$/,".txt");fetch(e).then(t=>{if(t.ok)return t.text();throw new Error("TXTÊñá‰ª∂‰∏çÂ≠òÂú®")}).then(t=>{parseAndDisplayLyrics(t)}).catch(t=>{p(".lyrics-line.current").text("ÊöÇÊó†Ê≠åËØç‰ø°ÊÅØ")})}).finally(()=>{adjustPlayerHeight()}))}(i[t])}),e='<source src="'+a.audioUrl+'" type="audio/'+a.extension+'">',"mp3"===a.extension?e='<source src="'+a.audioUrl+'" type="audio/mpeg">':"m4a"===a.extension?e='<source src="'+a.audioUrl+'" type="audio/mp4">':"wma"===a.extension?e='<source src="'+a.audioUrl+'" type="audio/x-ms-wma">':"aif"!==a.extension&&"aiff"!==a.extension||(e='<source src="'+a.audioUrl+'" type="audio/x-aiff">'),r=p("<audio>").html(e).appendTo("#player"),f=r[0])&&((e=l[a.audioUrl])&&(f.currentTime=e),f.volume=p(".mute").hasClass("enable")?0:T,f.addEventListener("progress",A,!1),f.addEventListener("durationchange",A,!1),f.addEventListener("canplay",$,!1),f.addEventListener("ended",H,!1),f.addEventListener("error",M,!1),v)&&(clearInterval(m),m=setInterval(L,500))};function parseAndDisplayLyrics(e){"string"!=typeof e&&(e=e&&"object"==typeof e?e.lyrics?"string"==typeof e.lyrics?e.lyrics:JSON.stringify(e.lyrics):e.data?Array.isArray(e.data)?e.data.map(t=>"string"==typeof t?t:String(t)).join("\n"):"string"==typeof e.data?e.data:String(e.data):e.text?"string"==typeof e.text?e.text:String(e.text):JSON.stringify(e):String(e)),y=[];try{var i=e.split("\n"),a=[];for(let t=0;t<i.length;t++){var l=i[t].trim();if(l){for(var n,r=/\[(\d{1,3}):(\d{2})(?::(\d{2}))?(?:\.(\d{1,3}))?]/g;null!==(n=r.exec(l));){var s=void 0!==n[3],o=void 0!==n[4];let t=0,e=0,i=0,r=0;r=(i=s?(t=parseInt(n[1]),e=parseInt(n[2]),parseInt(n[3])):(e=parseInt(n[1]),parseInt(n[2])),o?parseInt(n[4]):0);var c=3600*t+60*e+i+r/1e3,d=l.replace(/\[\d{1,3}:\d{2}(?::\d{2})?(?:\.\d{1,3})?]/g,"").trim();d&&a.push({time:c,text:d})}!r.test(l)&&l&&0===a.length&&a.push({time:0,text:l})}}a.sort((t,e)=>t.time-e.time);var u=[];for(let t=0;t<a.length;t++)0!==t&&a[t].text===a[t-1].text||u.push(a[t]);y=u,h=!0,f&&f.currentTime?updateLyricsDisplay(f.currentTime):0<y.length&&(p(".lyrics-line.current").text(y[0].text),1<y.length)&&p(".lyrics-line.next").text(y[1].text)}catch(t){y.push({time:0,text:e.trim()}),h=!0,p(".lyrics-line.current").text(e.trim())}finally{adjustPlayerHeight()}}function updateLyricsDisplay(e){let t=p(".lyrics-container");if(p(".lyrics-line").empty(),0===d)p(".lyrics-toggle").css("opacity","0.6"),t.hide();else if(p(".lyrics-toggle").css("opacity","1"),t.show(),h&&0!==y.length){let i=-1;for(let t=0;t<y.length&&y[t].time<=e;t++)i=t;if(1===d)if(p(".lyrics-line").removeClass("current next").empty(),0<=i){let e=i;Math.min(y.length-1,e+1);i===y.length-1&&0<i&&(e=i-1,i);var r=p(".lyrics-line");for(let t=0;t<2;t++){var a=e+t;a<y.length&&t<r.length?(r.eq(t).text(y[a].text),a===i?r.eq(t).addClass("current"):a===i+1&&r.eq(t).addClass("next")):t<r.length&&r.eq(t).html("&nbsp;")}}else{var l=p(".lyrics-line");for(let t=0;t<2;t++)t<y.length&&t<l.length?(l.eq(t).text(y[t].text),0===t?l.eq(t).addClass("current"):1===t&&l.eq(t).addClass("next")):t<l.length&&l.eq(t).html("&nbsp;")}else if(2===d){let t=p(".lyrics-container");for(;t.children(".lyrics-line").length<4;)t.append(p('<div class="lyrics-line"></div>'));for(;4<t.children(".lyrics-line").length;)t.children(".lyrics-line").last().remove();if(t.children(".lyrics-line").removeClass("current next").empty(),0<=i){let e=Math.max(0,i-1);var n=Math.min(y.length-1,e+3),s=(n-e<3&&(e=Math.max(0,n-3)),t.children(".lyrics-line"));for(let t=0;t<4;t++){var o=e+t;o<y.length?(s.eq(t).text(y[o].text),o===i?s.eq(t).addClass("current"):o===i+1&&s.eq(t).addClass("next")):s.eq(t).empty()}}else{var c=t.children(".lyrics-line");for(let t=0;t<4;t++)t<y.length?(c.eq(t).text(y[t].text),0===t?c.eq(t).addClass("current"):1===t&&c.eq(t).addClass("next")):c.eq(t).empty()}}}else 1<=d&&p(".lyrics-line.current").text("ÊöÇÊó†Ê≠åËØç‰ø°ÊÅØ")}function adjustPlayerHeight(){var t=p("#playlist"),e=p(".lyrics-container"),i=e.is(":visible"),r=t.is(":visible");let a=130;i&&(a+=e.outerHeight(!0)),r&&(i=t[0].scrollHeight,a+=i),a=Math.min(a,500),window.parent.postMessage({type:"adjustMP3PlayerHeight",height:a},"*")}p(document).ready(function(){"true"===r&&p(".shuffle").addClass("enable"),1==i?p(".repeat").addClass("once"):2==i&&p(".repeat").addClass("all"),p("#playlist").hide(),p(".playlist-toggle").removeClass("enable"),updateLyricsDisplay(),adjustPlayerHeight(),p(".playback").on("click",function(){(p(this).hasClass("playing")?D:U)()}),p(".rewind").on("click",function(){"true"===r?j():E(--g,!!x)}),p(".fastforward").on("click",function(){"true"===r?j():E(++g,!!x)}),p(".repeat").on("click",function(){p(this).hasClass("once")?(i=localStorage.repeat=2,p(this).removeClass("once").addClass("all")):p(this).hasClass("all")?(i=localStorage.repeat=0,p(this).removeClass("all")):(i=localStorage.repeat=1,p(this).addClass("once"))}),p(".shuffle").on("click",function(){p(this).hasClass("enable")?(r=localStorage.shuffle="false",p(this).removeClass("enable")):(r=localStorage.shuffle="true",p(this).addClass("enable"))}),p(".playlist-toggle").on("click",function(){let i=p("#playlist");i.slideToggle(300,function(){if(i.is(":visible")){let t=130;var e=p(".lyrics-container"),e=(e.is(":visible")&&(t+=e.outerHeight(!0)),i[0].scrollHeight);t+=e,t=Math.min(t,500),window.parent.postMessage({type:"adjustMP3PlayerHeight",height:t},"*")}else{let t=130;e=p(".lyrics-container");e.is(":visible")&&(t+=e.outerHeight(!0)),window.parent.postMessage({type:"adjustMP3PlayerHeight",height:t},"*")}}),p(this).toggleClass("enable")}),p(".lyrics-toggle").on("click",function(){d=(d+1)%3,localStorage.lyricsDisplayMode=d,updateLyricsDisplay(),adjustPlayerHeight()}),p("#playlist").on("click",".dir-toggle",function(){adjustPlaylistHeight()}),p("#playlist").on("click",".dir-name",function(){adjustPlaylistHeight()}),p("#playlist").on("click",".dir-play-btn",function(){var t=p(this).closest(".directory-item");!function playDirectory(t,e){t=function collectDirectorySongs(e,i){var r=[];for(let t=0;t<c.length;t++){var a=c[t];("root"===i||a.directory===e)&&r.push(t)}return r}(t,e);0<t.length&&(x=(C=t).map(t=>c[t]),E(0,!0))}(t.data("dir-path"),t.data("dir-type"))})})})(jQuery);