(p=>{var a=localStorage.repeat||0,r=localStorage.shuffle||"false",i=!0,e=!0,f=[],y=!1,d=parseInt(localStorage.lyricsDisplayMode||0),l=JSON.parse(localStorage.playbackPositions||"{}"),n=parseInt(localStorage.lastPlayedTrack||-1),s="true"===localStorage.shouldAutoResume,c=(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),[]),o={},u={};function loadBasicPlaylist(t){c=[];for(let e=0;e<t.length;e++){var a=t[e],r=function extractFileNameFromPath(e){e=e.split(/[\\/]/).pop();return e}(a),i="/app-center-static/serviceicon/fndesk/MP3/"+a,i={title:function getFileNameWithoutExtension(e){return e.replace(/\.(mp3|wav|flac|aac|ogg|wma|m4a|aif|aiff)$/i,"")}(r),artist:"Êú™Áü•Ëâ∫ÊúØÂÆ∂",album:"Êú™Áü•‰∏ìËæë",picture:null,audioUrl:i,extension:r.split(".").pop().toLowerCase(),fullPath:a,directory:function getFileDirectory(e){e=e.split(/[\\/]/);return e.pop(),e.join("/")}(a)};c.push(i)}!function loadPlaylistToPage(){p("#playlist").empty(),function renderDirectoryStructure(t,e,l){let a=t.files.length;Object.keys(t.children).forEach(e=>{a+=countFilesInDirectory(t.children[e])});let r=0<Object.keys(t.children).length||0<t.files.length;let i=getDirectoryId(t);let n="&nbsp;".repeat(4*l);let s=p(`<li class="directory-item" data-dir-id="${i}" data-dir-type="${t.type}" data-dir-path="${t.path}" style="padding-left: 0;">
			${n}<span class="dir-toggle" style="display: inline-block; width: 20px; cursor: pointer; text-align: center;">${r?"‚ïã":""}</span>
			<span class="dir-name">${t.name} (${a})</span>
			${0<a?'<span class="dir-play-btn" style="margin-left: 10px; cursor: pointer; color: #4CAF50;">‚ñ∂</span>':""}
		</li>`);e.append(s);let o=p(`<ul class="dir-children" id="${i}-children" style="list-style: none; padding-left: 0; display: none;"></ul>`);e.append(o);t.files.forEach(r=>{let i=c[r.index];if(i){let e="&nbsp;".repeat(4*(l+1)),t=i.artist&&"Êú™Áü•Ëâ∫ÊúØÂÆ∂"!==i.artist?i.artist+" - "+i.title:i.title,a=p(`<li class="file-item" data-index="${r.index}" style="cursor: pointer; padding-left: 0;">
						${e}üéµ ${t}
					</li>`);o.append(a)}});Object.keys(t.children).sort().forEach(e=>{renderDirectoryStructure(t.children[e],o,l+1)});"root"===t.type&&(o.show(),r)&&s.find(".dir-toggle").text("‚îÅ")}(u,p("#playlist"),0),function bindPlaylistClick(){p("#playlist").off("click",".directory-item .dir-toggle").on("click",".directory-item .dir-toggle",function(e){e.stopPropagation(),toggleDirectory(p(this))}),p("#playlist").off("click",".directory-item .dir-name").on("click",".directory-item .dir-name",function(e){e.stopPropagation(),toggleDirectory(p(this).siblings(".dir-toggle"))}),p("#playlist").off("dblclick",".directory-item").on("dblclick",".directory-item",function(e){e.stopPropagation();var e=p(this),t=e.data("dir-type"),e=e.data("dir-path");"root"===t?playDirectorySongs(u):(t=function findDirectoryByPath(t,a){if(t.path===a)return t;for(var r in t.children){let e=findDirectoryByPath(t.children[r],a);if(e)return e}return null}(u,e))&&playDirectorySongs(t)}),p("#playlist").off("click",".file-item").on("click",".file-item",function(){var e=p(this).data("index");E(parseInt(e))})}()}(),0<c.length&&function resumePlaybackIfNeeded(){if(0<=n&&n<c.length){var e=c[n],t=e?l[e.audioUrl]:void 0;if(void 0!==t)return l[e.audioUrl]=t,h=n,setTimeout(()=>{B(n),s&&setTimeout(()=>{P()},500)},100)}var a=JSON.parse(localStorage.playbackPositions||"{}"),e=Object.keys(a);if(0<e.length){var r=e[0];a[r];let t=-1;for(let e=0;e<c.length;e++)if(c[e].audioUrl===r){l=a,h=e,setTimeout(()=>{B(e),s&&setTimeout(()=>{P()},500)},100),t=e;break}if(-1===t)for(let e=0;e<c.length;e++)if(c[e].audioUrl===r){l=a,h=e,setTimeout(()=>{B(e),s&&setTimeout(()=>{P()},500)},100);break}}else 0<c.length&&(h=0,setTimeout(()=>{B(0),s&&setTimeout(()=>{P()},500)},100))}()}function getDirectoryId(e){return"root"===e.type?"root-directory":"dir-"+e.path.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g,"-")}function countFilesInDirectory(t){let a=t.files.length;return Object.keys(t.children).forEach(e=>{a+=countFilesInDirectory(t.children[e])}),a}function loadSingleAudioMetadata(i,l=!1){if(o[i])return l&&updateNowPlayingInfo(i),Promise.resolve();let n=c[i];return n?(o[i]=!0,new Promise(r=>{"flac"===n.extension?function loadFlacMetadata(r,i,l,n){fetch(r.audioUrl).then(e=>{if(e.ok)return e.arrayBuffer();throw new Error("Network response was not ok")}).then(e=>{try{var t=function parseFlacMetadata(e){let t=new DataView(e),a=0;if(1716281667!==t.getUint32(0))throw new Error("Not a valid FLAC file");a=4;var r={title:null,artist:null,album:null,lyrics:null,picture:null};for(;a<e.byteLength;){var i=t.getUint32(a),l=(a+=4,0!=(2147483648&i)),n=(2130706432&i)>>24,i=16777215&i;if(4==n){var s=function parseVorbisComment(t){let a=0,r={},e=readUint32LittleEndian(t,a);a+=4+e;var i=readUint32LittleEndian(t,a);a+=4;for(let e=0;e<i&&!(a>=t.length);e++){var l=readUint32LittleEndian(t,a);if((a+=4)+l>t.length)break;var n,s=decodeUTF8(t.slice(a,a+l)),l=(a+=l,s.indexOf("="));-1!==l&&(n=s.substring(0,l),s=s.substring(l+1),r[n.toUpperCase()]=s)}return r}(new Uint8Array(e,a,i));r.title=s.TITLE||s.Title||s.title||r.title,r.artist=s.ARTIST||s.Artist||s.artist||r.artist,r.album=s.ALBUM||s.Album||s.album||r.album,r.lyrics=s.LYRICS||s.Lyrics||s.lyrics||s.UNSYNCEDLYRICS||s.UnsyncedLyrics||s.unsyncedlyrics||s.UNSYNCHRONISEDLYRICS||s.UnsynchronisedLyrics||s.unsynchronisedlyrics||r.lyrics}else if(6==n)try{var o=new Uint8Array(e,a,i);r.picture=function parsePictureBlock(e){let t=0,a=readUint32BigEndian(e,0),r=readUint32BigEndian(e,t+=4),i=(t+=4,function decodeASCII(t){let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return a}(e.slice(8,8+r))),l=readUint32BigEndian(e,t+=r),n=(t+=4,decodeUTF8(e.slice(t,t+l))),s=readUint32BigEndian(e,t+=l),o=readUint32BigEndian(e,t+=4),c=(readUint32BigEndian(e,t+=4),readUint32BigEndian(e,t+=4),readUint32BigEndian(e,t+=4)),d=(t+=4,e.slice(t,t+c));return{format:i,data:d,type:a,description:n,width:s,height:o}}(o)}catch(e){}if(a+=i,l)break}return r}(e),a=r.title;r.title=t.title||a,r.artist=t.artist||"Êú™Áü•Ëâ∫ÊúØÂÆ∂",r.album=t.album||"Êú™Áü•‰∏ìËæë",r.lyrics=t.lyrics||null,r.picture=t.picture||null,l&&updateNowPlayingInfo(i),updatePlaylistItemDisplay(i),n()}catch(e){l&&updateNowPlayingInfo(i),o[i]=!0,n()}}).catch(e=>{l&&updateNowPlayingInfo(i),o[i]=!0,n()})}(n,i,l,r):"undefined"==typeof jsmediatags?(l&&updateNowPlayingInfo(i),r()):fetch(n.audioUrl).then(e=>{if(e.ok)return e.blob();throw new Error("Network response was not ok")}).then(e=>{jsmediatags.read(e,{tags:["title","artist","album","picture","lyrics","LYRICS","Lyrics","USLT","unsynchronised lyrics","Unsynchronised Lyrics"],onSuccess:function(e){var t=n.title;if(n.title=e.tags.title||t,n.artist=e.tags.artist||"Êú™Áü•Ëâ∫ÊúØÂÆ∂",n.album=e.tags.album||"Êú™Áü•‰∏ìËæë",n.picture=e.tags.picture,n.lyrics=e.tags.lyrics||e.tags.LYRICS||e.tags.Lyrics||e.tags.USLT||e.tags["unsynchronised lyrics"]||e.tags["Unsynchronised Lyrics"]||null,!n.lyrics&&e.tags.USLT&&"object"==typeof e.tags.USLT&&(e.tags.USLT.text?n.lyrics=e.tags.USLT.text:e.tags.USLT.data&&(n.lyrics=e.tags.USLT.data)),!n.lyrics)for(var a in e.tags)if(e.tags.hasOwnProperty(a)){a=e.tags[a];if(a&&"object"==typeof a&&(a.text||a.data)){a=a.text||a.data;if("string"==typeof a&&50<a.length){n.lyrics=a;break}}}l&&updateNowPlayingInfo(i),updatePlaylistItemDisplay(i),r()},onError:function(e){l&&updateNowPlayingInfo(i),o[i]=!0,r()}})}).catch(e=>{l&&updateNowPlayingInfo(i),o[i]=!0,r()})})):Promise.resolve()}function readUint32BigEndian(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function readUint32LittleEndian(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function decodeUTF8(e){let t="",a=0;for(;a<e.length;){var r,i,l=e[a++];l<128?t+=String.fromCharCode(l):192<=l&&l<224?(r=63&e[a++],t+=String.fromCharCode((31&l)<<6|r)):224<=l&&l<240?(r=63&e[a++],i=63&e[a++],t+=String.fromCharCode((15&l)<<12|r<<6|i)):240<=l&&l<248&&(i=(7&l)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++],i-=65536,t+=String.fromCharCode(55296+(i>>10),56320+(1023&i)))}return t}function updateNowPlayingInfo(e){var a=c[e];if(a){if(a.picture)if(a.picture.format&&a.picture.data)try{let t="";if(a.picture.data instanceof Uint8Array){var r=a.picture.data.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(a.picture.data[e])}else{if(!Array.isArray(a.picture.data))throw new Error("Unsupported picture data format");for(let e=0;e<a.picture.data.length;e++)t+=String.fromCharCode(a.picture.data[e])}let e="data:"+a.picture.format+";base64,"+btoa(t);p(".cover").html('<img src="'+e+'" alt="'+a.album+'">')}catch(e){p(".cover").html('<div class="no-cover">'+a.title+"</div>")}else try{for(var t="",i=0;i<a.picture.data.length;i++)t+=String.fromCharCode(a.picture.data[i]);var l="data:"+a.picture.format+";base64,"+window.btoa(t);p(".cover").html('<img src="'+l+'" alt="'+a.album+'">')}catch(e){p(".cover").html('<div class="no-cover">'+a.title+"</div>")}else p(".cover").html('<div class="no-cover">'+a.title+"</div>");p(".tag").html("<strong>"+a.title+'</strong><span class="artist">'+a.artist+'</span><span class="album">'+a.album+"</span>"),!function highlightCurrentSongDirectory(e){e=c[e];if(e){if(p("#playlist .directory-item").removeClass("current-dir"),e.directory){var a=e.directory.split(/[\\/]/);let t="";for(let e=0;e<a.length;e++){0<e&&(t+="/"),t+=a[e];var r=p(`.directory-item[data-dir-path="${t}"]`);0<r.length&&r.addClass("current-dir")}}p('.directory-item[data-dir-type="root"]').addClass("current-dir")}}(e)}}function updatePlaylistItemDisplay(e){var t=c[e];t&&(t=t.artist&&"Êú™Áü•Ëâ∫ÊúØÂÆ∂"!==t.artist?t.artist+" - "+t.title:t.title,p(`#playlist .file-item[data-index="${e}"]`).html("&nbsp;".repeat(4*function getItemIndentLevel(e){e=c[e];if(!e)return 0;e=e.directory?e.directory.split(/[\\/]/):[];return e.length+1}(e))+"üéµ "+t))}function toggleDirectory(e){var t=e.closest(".directory-item").data("dir-id"),t=p("#"+t+"-children");t.is(":visible")?(t.hide(),e.text("‚ïã")):(t.show(),e.text("‚îÅ"))}function playDirectorySongs(e){e=function collectSongIndices(t){let a=[];t.files.forEach(e=>{a.push(e.index)});Object.keys(t.children).forEach(e=>{a=a.concat(collectSongIndices(t.children[e]))});return a}(e);0<e.length&&(S=e.map(e=>c[e]),E((x=e)[0],!0))}document.addEventListener("DOMContentLoaded",function(){!function checkLoginStatus(){var e="true"===localStorage.getItem("musicPlayerAuthenticated"),t=localStorage.getItem("musicPlayerAuthExpiration");e&&t?(e=new Date(t),t=new Date,e<=t?(localStorage.removeItem("musicPlayerAuthenticated"),localStorage.removeItem("musicPlayerAuthExpiration"),window.location.href="login.html"):("true"===localStorage.getItem("musicPlayerNoPasswordMode")&&p(".logout").hide(),function initPlayer(){!function scanAudioDirectory(){fetch("/app-center-static/serviceicon/fndesk/MP3.json").then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")}).then(e=>{!function buildDirectoryStructure(a){u={name:"ÂÖ®ÈÉ®Ê≠åÊõ≤",type:"root",path:"",children:{},files:[]};for(let e=0;e<a.length;e++){var r=a[e].split(/[\\/]/);let t=u;for(let e=0;e<r.length-1;e++){var i=r[e],l=function getPathToDirectory(e,t){return""!==e.path?e.path+"/"+t:t}(t,i);t.children[i]||(t.children[i]={name:i,type:"directory",path:l,parent:t,children:{},files:[]}),t=t.children[i]}t.files.push({index:e,name:r[r.length-1]})}}(e),loadBasicPlaylist(e)}).catch(e=>{loadBasicPlaylist([])})}()}())):window.location.href="login.html"}()}),new Date;var h=0,g=null,m=null,v=!1,t=null,b=0,C=0,S=null,x=null,k=!1,w=!1,I=0,D=3;function checkStall(){k||w||g&&v&&(g.currentTime===b?3<=++C&&(stopStallDetection(),I=0,"true"===r?A():E(++h,!!S)):(C=0,b=g.currentTime,I=0))}function startStallDetection(){C=b=0,w=!1,t=setInterval(checkStall,1e4)}function stopStallDetection(){t&&(clearInterval(t),t=null),w=!0}function H(e){var t,a,r,i;g&&(t=parseInt(e/60),a=parseInt(e%60)<10?"0"+parseInt(e%60):parseInt(e%60),r=parseInt(g.duration/60),i=parseInt(g.duration%60)<10?"0"+parseInt(g.duration%60):parseInt(g.duration%60),e=e/g.duration*100)&&isFinite(e)&&(p(".timer").html(t+":"+a+" / "+r+":"+i),p(".progress-bar .pace").css("width",e+"%"),p(".progress-bar .slider a").css("left",e+"%"))}function K(e){g&&(g.volume=localStorage.volume=e),p(".volume .pace").css("width",100*e+"%"),p(".volume .slider a").css("left",100*e+"%")}var P=function(){var e;g?(e=g.play(),startStallDetection(),void 0!==e?e.then(function(){p(".playback").addClass("playing"),p(".playback i").removeClass("fa-play").addClass("fa-pause"),m=setInterval(T,500),v=!0,localStorage.shouldAutoResume="true"}).catch(function(e){p(".playback").removeClass("playing"),p(".playback i").removeClass("fa-pause").addClass("fa-play"),v=!1}):(p(".playback").addClass("playing"),p(".playback i").removeClass("fa-play").addClass("fa-pause"),m=setInterval(T,500),v=!0,localStorage.shouldAutoResume="true")):startStallDetection()},U=function(){g&&(g.pause(),p(".playback").removeClass("playing"),p(".playback i").removeClass("fa-pause").addClass("fa-play"),clearInterval(m),v=!1,localStorage.shouldAutoResume="false",stopStallDetection())},T=function(){if(!p(".progress-bar .slider").hasClass("enable")&&g&&(H(g.currentTime),updateLyricsDisplay(g.currentTime),Math.floor(g.currentTime)%5==0)){var e=c[h];if(e&&10<g.currentTime){l[e.audioUrl]=g.currentTime;try{localStorage.playbackPositions=JSON.stringify(l),localStorage.lastPlayedTrack=h}catch(e){}}}},L=(p(".progress-bar .slider").on("touchstart",function(e){e.preventDefault(),p(this).addClass("enable"),clearInterval(m)}).on("touchmove",function(e){var t;e.preventDefault(),g&&g.duration&&(e=e.originalEvent.touches[0],t=this.getBoundingClientRect(),e=e.clientX-t.left,e=Math.max(0,Math.min(100,e/t.width*100)),H(g.duration*e/100),p(".progress-bar .pace").css("width",e+"%"),p(".progress-bar .slider a").css("left",e+"%"))}).on("touchend",function(e){var t;e.preventDefault(),p(this).removeClass("enable"),g&&g.duration&&isFinite(g.duration)&&(t=this.getBoundingClientRect(),e=e.originalEvent.changedTouches[0].clientX-t.left,e=Math.max(0,Math.min(100,e/t.width*100)),t=g.duration*e/100,isFinite(t)&&(g.currentTime=t),m=setInterval(T,500))}),p(".progress-bar .slider").slider({step:.1,slide:function(e,t){g&&(p(this).addClass("enable"),H(g.duration*t.value/100),clearInterval(m))},stop:function(e,t){g&&g.duration&&isFinite(g.duration)&&(t=g.duration*t.value/100,isFinite(t)&&(g.currentTime=t),p(this).removeClass("enable"),m=setInterval(T,500))}}),localStorage.volume||.5),E=(p(".volume .slider").slider({max:1,min:0,step:.01,value:L,slide:function(e,t){K(t.value),p(this).addClass("enable"),p(".mute").removeClass("enable"),p(".mute i").removeClass("fa-volume-mute").addClass("fa-volume-up")},stop:function(){p(this).removeClass("enable")}}).children(".pace").css("width",100*L+"%"),p(".mute").click(function(){g&&(p(this).hasClass("enable")?(K(p(this).data("volume")),p(this).removeClass("enable"),p(".mute i").removeClass("fa-volume-mute").addClass("fa-volume-up")):(p(this).data("volume",g.volume).addClass("enable"),K(0),p(".mute i").removeClass("fa-volume-up").addClass("fa-volume-mute")))}),function(e,t=!1){k=!0;var a=t&&S?S:c;track=e<(I=0)?h=a.length-1:e>=a.length?h=0:e,g&&(g.pause(),g.removeEventListener("error",M),g=null),p("audio").remove(),B(track,t),1==v&&P(),k=!1}),A=function(){var e=S||c,t=new Date;h==(h=t.getTime()%e.length)&&++h,E(h,!!S)},$=function(){U(),g&&(g.currentTime=0),1==i&&(v=!0);var e=c[h];if(e){delete l[e.audioUrl];try{localStorage.playbackPositions=JSON.stringify(l);var t=(h+1)%c.length;localStorage.lastPlayedTrack=t}catch(e){}}1==a?P():"true"===r?A():(2==a||h<(S||c).length)&&E(++h,!!S),1==i&&v?setTimeout(()=>{try{P()}catch(e){p(".playback").addClass("playing"),p(".playback i").removeClass("fa-play").addClass("fa-pause")}},100):(v=!1,p(".playback").removeClass("playing"),p(".playback i").removeClass("fa-pause").addClass("fa-play"))},N=function(){var e=this.seekable&&this.seekable.length?this.seekable.end(0):0;p(".progress-bar .loaded").css("width",100/(this.duration||1)*e+"%")},j=function(){(1==e||v&&i)&&P()},M=function(){stopStallDetection(),D<=++I?(function showErrorMessage(e){let t=p("#error-message");0===t.length&&(t=p('<div id="error-message" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: #ff5555; padding: 20px; border-radius: 10px; z-index: 9999; text-align: center; box-shadow: 0 0 20px rgba(255,0,0,0.5);"></div>'),p("body").append(t));t.html(e),t.show(),setTimeout(()=>{t.fadeOut()},3e3)}("ËøûÁª≠Êí≠ÊîæÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂ÊàñÊâãÂä®ÈÄâÊã©ÂÖ∂‰ªñÊ≠åÊõ≤"),v=!1,p(".playback").removeClass("playing"),p(".playback i").removeClass("fa-pause").addClass("fa-play")):(g&&(g.removeEventListener("error",M),g=null),"true"===r?A():E(++h,!!S))},B=function(e,t=!1){let a=t&&S?S:c;var r=t&&x?x[e]:e,i=a[e];i&&(stopStallDetection(),h=e,p(".cover").html('<div class="no-cover">'+i.title+"</div>"),p(".tag").html("<strong>"+i.title+'</strong><span class="artist">'+i.artist+'</span><span class="album">'+i.album+"</span>"),p("#playlist .file-item").removeClass("playing"),(t?(t=x?x[e]:e,p(`#playlist .file-item[data-index="${t}"]`)):p(`#playlist .file-item[data-index="${r}"]`)).addClass("playing"),function scrollToCurrentSong(e){let l=p(`#playlist .file-item[data-index="${e}"]`);0<l.length&&(!function expandParentDirectories(e){e=c[e];if(e&&e.directory){var a=e.directory.split(/[\\/]/);let t="";for(let e=0;e<a.length;e++){0<e&&(t+="/"),t+=a[e];var r,i=p(`.directory-item[data-dir-path="${t}"]`);0<i.length&&(r=i.data("dir-id"),r=p("#"+r+"-children"),i=i.find(".dir-toggle"),r.is(":visible")||(r.show(),i.text("‚îÅ")))}var e=p('.directory-item[data-dir-type="root"]'),l=e.data("dir-id"),l=p("#"+l+"-children"),e=e.find(".dir-toggle");l.is(":visible")||(l.show(),e.text("‚îÅ"))}}(e),setTimeout(()=>{var e=p("#playlist"),t=e.scrollTop(),a=e.height(),r=l.position().top,i=l.outerHeight();(r<0||a<r+i)&&e.animate({scrollTop:t+r-a/2},300)},350))}(r),loadSingleAudioMetadata(r,!0).then(()=>{!function loadLyrics(a){var e;f=[],y=!1,p(".lyrics-line").empty(),a.lyrics?(parseAndDisplayLyrics(a.lyrics),adjustPlayerHeight()):(e=a.audioUrl.replace(/\.[^\.]+$/,".lrc"),fetch(e).then(e=>{if(e.ok)return e.text();throw new Error("LRCÊñá‰ª∂‰∏çÂ≠òÂú®")}).then(e=>{parseAndDisplayLyrics(e)}).catch(e=>{var t=a.audioUrl.replace(/\.[^\.]+$/,".txt");fetch(t).then(e=>{if(e.ok)return e.text();throw new Error("TXTÊñá‰ª∂‰∏çÂ≠òÂú®")}).then(e=>{parseAndDisplayLyrics(e)}).catch(e=>{p(".lyrics-line.current").text("ÊöÇÊó†Ê≠åËØç")})}).finally(()=>{adjustPlayerHeight()}))}(a[e])}),t='<source src="'+i.audioUrl+'" type="audio/'+i.extension+'">',"mp3"===i.extension?t='<source src="'+i.audioUrl+'" type="audio/mpeg">':"m4a"===i.extension?t='<source src="'+i.audioUrl+'" type="audio/mp4">':"wma"===i.extension?t='<source src="'+i.audioUrl+'" type="audio/x-ms-wma">':"aif"!==i.extension&&"aiff"!==i.extension||(t='<source src="'+i.audioUrl+'" type="audio/x-aiff">'),r=p("<audio>").html(t).appendTo("#player"),g=r[0])&&((t=l[i.audioUrl])&&(g.currentTime=t),g.volume=p(".mute").hasClass("enable")?0:L,g.addEventListener("progress",N,!1),g.addEventListener("durationchange",N,!1),g.addEventListener("canplay",j,!1),g.addEventListener("ended",$,!1),g.addEventListener("error",M,!1),v)&&(clearInterval(m),m=setInterval(T,500))};function parseAndDisplayLyrics(t){"string"!=typeof t&&(t=t&&"object"==typeof t?t.lyrics?"string"==typeof t.lyrics?t.lyrics:JSON.stringify(t.lyrics):t.data?Array.isArray(t.data)?t.data.map(e=>"string"==typeof e?e:String(e)).join("\n"):"string"==typeof t.data?t.data:String(t.data):t.text?"string"==typeof t.text?t.text:String(t.text):JSON.stringify(t):String(t)),f=[];try{var a=t.split("\n"),i=[];for(let e=0;e<a.length;e++){var l=a[e].trim();if(l){for(var n,r=/\[(\d{1,3}):(\d{2})(?::(\d{2}))?(?:\.(\d{1,3}))?]/g;null!==(n=r.exec(l));){var s=void 0!==n[3],o=void 0!==n[4];let e=0,t=0,a=0,r=0;r=(a=s?(e=parseInt(n[1]),t=parseInt(n[2]),parseInt(n[3])):(t=parseInt(n[1]),parseInt(n[2])),o?parseInt(n[4]):0);var c=3600*e+60*t+a+r/1e3,d=l.replace(/\[\d{1,3}:\d{2}(?::\d{2})?(?:\.\d{1,3})?]/g,"").trim();d&&i.push({time:c,text:d})}!r.test(l)&&l&&0===i.length&&i.push({time:0,text:l})}}i.sort((e,t)=>e.time-t.time);var u=[];for(let e=0;e<i.length;e++)0!==e&&i[e].text===i[e-1].text||u.push(i[e]);f=u,y=!0,g&&g.currentTime?updateLyricsDisplay(g.currentTime):0<f.length&&(p(".lyrics-line.current").text(f[0].text),1<f.length)&&p(".lyrics-line.next").text(f[1].text)}catch(e){f.push({time:0,text:t.trim()}),y=!0,p(".lyrics-line.current").text(t.trim())}finally{adjustPlayerHeight()}}function updateLyricsDisplay(t){let e=p(".lyrics-container");if(p(".lyrics-line").empty(),0===d)p(".lyrics-toggle").removeClass("enable"),e.hide();else if(p(".lyrics-toggle").addClass("enable"),e.show(),y&&0!==f.length){let a=-1;for(let e=0;e<f.length&&f[e].time<=t;e++)a=e;if(1===d)if(p(".lyrics-line").removeClass("current next").empty(),0<=a){let t=a;Math.min(f.length-1,t+1);a===f.length-1&&0<a&&(t=a-1,a);var r=p(".lyrics-line");for(let e=0;e<2;e++){var i=t+e;i<f.length&&e<r.length?(r.eq(e).text(f[i].text),i===a?r.eq(e).addClass("current"):i===a+1&&r.eq(e).addClass("next")):e<r.length&&r.eq(e).html("&nbsp;")}}else{var l=p(".lyrics-line");for(let e=0;e<2;e++)e<f.length&&e<l.length?(l.eq(e).text(f[e].text),0===e?l.eq(e).addClass("current"):1===e&&l.eq(e).addClass("next")):e<l.length&&l.eq(e).html("&nbsp;")}else if(2===d){let e=p(".lyrics-container");for(;e.children(".lyrics-line").length<4;)e.append(p('<div class="lyrics-line"></div>'));for(;4<e.children(".lyrics-line").length;)e.children(".lyrics-line").last().remove();if(e.children(".lyrics-line").removeClass("current next").empty(),0<=a){let t=Math.max(0,a-1);var n=Math.min(f.length-1,t+3),s=(n-t<3&&(t=Math.max(0,n-3)),e.children(".lyrics-line"));for(let e=0;e<4;e++){var o=t+e;o<f.length?(s.eq(e).text(f[o].text),o===a?s.eq(e).addClass("current"):o===a+1&&s.eq(e).addClass("next")):s.eq(e).empty()}}else{var c=e.children(".lyrics-line");for(let e=0;e<4;e++)e<f.length?(c.eq(e).text(f[e].text),0===e?c.eq(e).addClass("current"):1===e&&c.eq(e).addClass("next")):c.eq(e).empty()}}}else 1<=d&&p(".lyrics-line:first").text("ÊöÇÊó†Ê≠åËØç")}p(document).ready(function(){"true"===r&&p(".shuffle").addClass("enable"),1==a?p(".repeat").addClass("once"):2==a&&p(".repeat").addClass("all"),p("#playlist").show(),updateLyricsDisplay(),p(".playback").on("click",function(){(p(this).hasClass("playing")?U:P)()}),p(".rewind").on("click",function(){"true"===r?A():E(--h,!!S)}),p(".fastforward").on("click",function(){"true"===r?A():E(++h,!!S)}),p(".repeat").on("click",function(){p(this).hasClass("once")?(a=localStorage.repeat=2,p(this).removeClass("once").addClass("all")):p(this).hasClass("all")?(a=localStorage.repeat=0,p(this).removeClass("all")):(a=localStorage.repeat=1,p(this).addClass("once"))}),p(".shuffle").on("click",function(){p(this).hasClass("enable")?(r=localStorage.shuffle="false",p(this).removeClass("enable")):(r=localStorage.shuffle="true",p(this).addClass("enable"))}),p(".lyrics-toggle").on("click",function(){d=(d+1)%3,localStorage.lyricsDisplayMode=d,updateLyricsDisplay()}),p("#playlist").on("click",".dir-toggle",function(){}),p("#playlist").on("click",".dir-name",function(){}),p("#playlist").on("click",".dir-play-btn",function(){var e=p(this).closest(".directory-item");!function playDirectory(e,t){e=function collectDirectorySongs(t,a){var r=[];for(let e=0;e<c.length;e++){var i=c[e];("root"===a||i.directory===t)&&r.push(e)}return r}(e,t);0<e.length&&(S=(x=e).map(e=>c[e]),E(0,!0))}(e.data("dir-path"),e.data("dir-type"))})})})(jQuery);