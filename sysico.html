<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>飞牛桌面管理 - 系统图标管理</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        /* 深色科技风格颜色变量 */
        :root {
            --primary: #00a8ff;
            --secondary: #00d2d3;
            --accent: #5f27cd;
            --success: #10ac84;
            --danger: #ee5a24;
            --warning: #feca57;
            --info: #3498db;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --card-hover: #273449;
            --border-color: #334155;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --glow-primary: 0 0 10px rgba(0, 168, 255, 0.5);
            --glow-secondary: 0 0 15px rgba(0, 210, 211, 0.3);
        }

        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Rajdhani', 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(15, 23, 42, 0.95) 0%, rgba(15, 23, 42, 1) 90%),
                linear-gradient(to right, rgba(0, 168, 255, 0.03), transparent, rgba(0, 210, 211, 0.03));
            position: relative;
            overflow-x: hidden;
        }

        /* 主容器 */
        .container {
            width: 100%;
            max-width: 1024px;
            margin: 0 auto;
            padding: 0.5rem 0.5rem;
        }

        /* 导航栏样式 */
        .navbar {
            background: linear-gradient(90deg, var(--card-bg), var(--dark-bg));
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1024px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .navbar-actions {
            display: flex;
            gap: 0.5rem;
            /* 控制按钮之间的间距 */
        }

        .navbar-title {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .navbar-title-main {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            text-shadow: var(--glow-primary);
        }

        .navbar-title-sub {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* 预览图容器样式 */
        .preview-img-container {
            transition: all 0.3s ease !important;
            position: relative;
            z-index: 10;
        }

        .preview-img-container:hover {
            width: auto !important;
            height: 160px !important;
            z-index: 1000 !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .preview-img-container:hover img {
            object-fit: contain !important;
            width: auto !important;
            height: 100% !important;
        }

        /* 内容卡片 */
        .card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 1rem;
            margin-top: 0.6rem;
            margin-bottom: 1rem;
            box-shadow: 0 8px 32px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        .content-card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 1rem;
            margin-top: 0.6rem;
            margin-bottom: 1rem;
            box-shadow: 0 8px 32px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        .content-card h2 {
            color: var(--primary);
            font-size: 1.75rem;
            text-shadow: var(--glow-primary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
            text-shadow: var(--glow-primary);
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 0.8rem;
            padding: 0.5rem;
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
            gap: 0.5rem;
            overflow-x: auto;
            min-height: 45px;
        }

        /* 两列布局 */
        .form-group.two-column {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .form-column {
            flex: 1;
            min-width: 180px;
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
            gap: 0.5rem;
        }

        /* 表单项目布局 */
        .form-group,
        .form-column {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group label,
        .form-column label {
            display: inline-block;
            min-width: 60px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: left;
            flex-shrink: 0;
        }

        /* 输入框容器 */
        .input-container {
            flex: 1;
            min-width: 0;
        }

        input[type="text"],
        input[type="number"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            min-width: 0;
            padding: 0.5rem 0.8rem;
            background-color: var(--dark-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            vertical-align: middle;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="password"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 168, 255, 0.1);
        }

        /* 按钮样式 */
        .btn {
            min-width: 60px;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            vertical-align: middle;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--glow-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 168, 255, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--card-bg), var(--dark-bg));
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff6b35);
            color: white;
            box-shadow: 0 0 10px rgba(238, 90, 36, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(238, 90, 36, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* 隐藏文件输入 */
        input[type="file"] {
            display: none;
        }

        /* 返回按钮 */
        .back-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* 覆盖层用于阻止页面操作 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 9998;
        }

        /* 状态消息弹窗 */
        .status-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 1.5rem;
            border-radius: 0.5rem;
            display: none;
            font-weight: 500;
            min-width: 300px;
            max-width: 90%;
            text-align: center;
            z-index: 9999;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        /* 进度条容器 */
        .progress-container {
            margin-top: 1rem;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        /* 进度条 */
        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* 循环动画进度条 */
        .progress-bar.looping {
            width: 30%;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
            animation: progressLoop 2s ease-in-out infinite;
            background-size: 200% 100%;
        }

        /* 循环动画关键帧 */
        @keyframes progressLoop {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(350%);
            }
        }

        .status-message.success {
            background-color: rgba(16, 172, 132, 0.95);
            color: white;
            border: none;
        }

        .status-message.error {
            background-color: rgba(238, 90, 36, 0.95);
            color: white;
            border: none;
        }

        .status-message.info {
            background-color: rgba(52, 152, 219, 0.95);
            color: white;
            border: none;
        }

        /* 控制标签样式 */
        .control-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        /* 通知样式 */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
            animation: slideIn 0.3s ease-out;
        }

        .notification-success {
            background-color: #52c41a;
        }

        .notification-error {
            background-color: #ff4d4f;
        }

        .notification-warning {
            background-color: #faad14;
        }

        .notification-info {
            background-color: #1890ff;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* 响应式设计 */
        @media (max-width: 720px) {
            .form-group {
                flex-wrap: wrap;
                min-height: auto;
            }

            .form-group label {
                width: 100%;
                margin-bottom: 0.5rem;
                text-align: left;
            }

            .form-group input[type="text"] {
                width: 100%;
                margin-bottom: 1rem;
            }

            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .form-group.two-column {
                flex-direction: column;
                gap: 1rem;
            }

            .form-column {
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* 图标列表样式 */
        .loading-state,
        .empty-state {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
    </style>
</head>

<body>
    
    <div id="notification" class="notification" style="display: none;">
        <span id="notificationText"></span>
    </div>
    
    <header class="navbar">
        <div class="navbar-content">
            <div class="navbar-title">
                <div class="navbar-title-main">
                    <i class="fa fa-cogs"></i> 飞牛桌面管理工具
                </div>
                <div class="navbar-title-sub">注意：上传或者恢复默认后，需要点击【立即生效】</div>
            </div>
            <div class="navbar-actions">
                <a href="#" id="applyBtn" class="back-btn">
                    <i class="fa fa-check-circle"></i> 立即生效
                </a>
                <a href="index.html" class="back-btn">
                    <i class="fa fa-arrow-left"></i> 返回主页
                </a>
            </div>
        </div>
    </header>

    <div class="container">

        
        <div class="content-card">
            <h2><i class="fa fa-music"></i> Fndesk音乐播放器</h2>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                
                <div class="form-group" style="flex: 1; min-width: 300px; margin-bottom: 0;">
                    <label for="mp3Name" class="control-label">播放器标题：</label>
                    <div class="input-container">
                        <input type="text" id="mp3Name" placeholder="Fndesk音乐播放器">
                    </div>
                    <button type="button" class="btn btn-primary" id="saveMp3NameBtn">
                        <i class="fa fa-save"></i> 保存
                    </button>
                </div>

                
                <div class="form-group" style="flex: 1; min-width: 300px; margin-bottom: 0;">
                    <label for="mp3Path" class="control-label">音乐路径：</label>
                    <div class="input-container">
                        <input type="text" id="mp3Path" placeholder="/vol1/1000/music">
                    </div>
                    <button type="button" class="btn btn-primary" id="saveMp3PathBtn">
                        <i class="fa fa-save"></i> 保存
                    </button>
                </div>
            </div>

            
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                
                <div class="form-group" style="flex: 1; min-width: 300px; margin-bottom: 0;">
                    <label for="mp3Password" class="control-label">播放器密码：</label>
                    <div class="input-container">
                        <input type="password" id="mp3Password" placeholder="留空直接保存 = 关闭密码验证">
                    </div>
                    <button type="button" class="btn btn-primary" id="saveMp3PasswordBtn">
                        <i class="fa fa-save"></i> 保存
                    </button>
                </div>

                
                <div class="form-group" style="flex: 1; min-width: 300px; margin-bottom: 0;">
                    <label for="mp3Icon" class="control-label">播放器图标：</label>
                    <div class="input-container">
                        <input type="text" id="mp3Icon" placeholder="请输入图标URL 或 上传图片">
                    </div>
                    <input type="file" id="mp3IconUpload" accept="image/*" style="display: none;">
                    <button type="button" class="btn btn-secondary" id="triggerMp3IconUploadBtn">
                        <i class="fa fa-upload"></i> 上传
                    </button>
                    <button type="button" class="btn btn-primary" id="saveMp3IconBtn">
                        <i class="fa fa-save"></i> 保存
                    </button>
                </div>
            </div>
            <small style="display: block; margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                <span style="font-size: 1rem;font-weight: bold;color: rgb(202, 154, 51);">
        <a href="https://fndesk.imcq.top/images/fndesk播放器1.jpg" target="_blank" class="btn btn-secondary" style="margin-bottom: 0.2rem; padding: 0.2rem 0.4rem; font-size: 0.85rem; text-decoration: none !important;">
        <i class="fa fa-file-image-o"></i>图示1</a>
        <a href="https://fndesk.imcq.top/images/fndesk播放器2.jpg" target="_blank" class="btn btn-secondary" style="margin-bottom: 0.2rem; padding: 0.2rem 0.4rem; font-size: 0.85rem; text-decoration: none !important;">
        <i class="fa fa-file-image-o"></i>图示2</a>
                说明：</span>
                在飞牛文件管理器复制你的音乐路径，粘贴到音乐路径里保存>点击立即生效>清空缓存刷新后可在飞牛桌面左下角看到音乐播放图标(右键可打开独立播放器哦)，清空路径保存生效后将停用此功能，支持格式mp3,
                wav, flac, aac, ogg,
                m4a等常见格式，其他不确定，支持多层目录展开或收起，双击或点击目录播放按钮可播放指定目录曲目，支持记忆上次播放的曲目和播放进度,歌词显示,拖拽进度条,播放失败自动下一曲</small>
        </div>

        
        <div class="content-card">
            <h2><i class="fa fa-eye-slash"></i> 隐藏图标配置</h2>
            <div class="form-group">
                <label for="sysicoDisplay" class="control-label">隐藏图标：</label>
                <div class="input-container">
                    <textarea id="sysicoDisplay" placeholder="例如：应用中心,备份,Lucky" rows="4" style="resize: vertical;"></textarea>
                </div>
                <button type="button" class="btn btn-primary" id="saveSysicoDisplayBtn">
                    <i class="fa fa-save"></i> 保存
                </button>
            </div>
            <small style="display: block; margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.85rem;">填入要隐藏图标的名称，使用逗号分隔(仅对原生图标生效，原创图标可用开关控制)</small>
        </div>

        
        <div class="content-card">
            <h2><i class="fa fa-magic"></i> 生成飞牛原生APP图标</h2>
        
            
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; align-items: center;">
                
                <div class="form-group" style="margin-bottom: 0; cursor: pointer;">
                    <div id="fndeskAppIconPreview" style="width: 64px; height: 64px; border: 1px solid var(--border-color); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                        <i class="fa fa-image" style="font-size: 24px; color: var(--text-secondary);"></i>
                    </div>
                    <input type="file" id="fndeskAppIcon" accept="image/*" style="display: none;">
                </div>

                
                <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                    <label for="fndeskAppName" class="control-label">标题：</label>
                    <div class="input-container">
                        <input type="text" id="fndeskAppName" placeholder="飞牛原生图标">
                    </div>
                </div>
        
                
                <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                    <label for="fndeskAppType" class="control-label">打开方式：</label>
                    <div class="input-container">
                        <select id="fndeskAppType" style="width: 100%;">
                            <option value="iframe">页內</option>
                            <option value="url">新窗</option>
                        </select>
                    </div>
                </div>
               
                
                <div class="form-group" style="margin-bottom: 0;">
                    <button type="button" class="btn btn-primary" id="generateFndeskAppBtn">
                        <i class="fa fa-cogs"></i> 立即生成
                    </button>
                </div>
            </div>
        
            
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                
                <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                    <label for="fndeskAppDefaultUrl" class="control-label">默认地址：</label>
                    <div class="input-container">
                        <input type="text" id="fndeskAppDefaultUrl" placeholder="端口(/地址参数)或完整地址">
                    </div>
                </div>
        
                
                <div class="form-group" style="flex: 1; min-width: 200px; margin-bottom: 0;">
                    <label for="fndeskAppPublicUrl" class="control-label">公网地址：</label>
                    <div class="input-container">
                        <input type="text" id="fndeskAppPublicUrl" placeholder="可选，填写完整的公网地址">
                    </div>
                </div>
            </div>
<small style="display: block; margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">
    <span style="color: rgb(202, 154, 51);font-size: 1rem;font-weight: bold;">
        <a href="https://fndesk.imcq.top/images/%E5%9B%BE%E6%A0%87%E7%94%9F%E6%88%90%E5%A1%AB%E5%86%99%E7%A4%BA%E4%BE%8B.png" target="_blank" class="btn btn-secondary" style="margin-bottom: 0.2rem; padding: 0.2rem 0.4rem; font-size: 0.85rem; text-decoration: none !important;">
        <i class="fa fa-file-image-o"></i>图示</a>
         必看说明：</span>APP完美显示在,完全兼容FN Connect,图标完全等效于飞牛原生应用图标，彻底解决APP不能创建图标问题(每个相当于一个独立应用，卸载也需独立卸载)<br>
    模式一：默认地址直接填写端口号或者端口/地址参数（例如：5666，/index.html，9990/fnstyle.html等）,这种方式在具有良好的连通性,能在局域网和FN Connect等环境中使用(但公网需要映射端口)<br>
    模式二：填写完整url,例如默认地址填写内网url,公网地址填写公网url,这种方式会在打开链接的瞬间检测内网的连通性,如果连通,则使用内网url,如果不连通,则使用公网url<br>
    模式三：高级玩法，CGI路径，自行研究或进群讨论</small>
        </div>

        
        <div class="content-card">
            <h2><i class="fa fa-cogs"></i> 杂项功能</h2>
            <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                <label for="clickSoundSelect" class="control-label" style="min-width: auto; flex-shrink: 0;">点击音效：</label>
                <select id="clickSoundSelect" style="width: 80px; flex-shrink: 0;">
                    <option value="0">没有</option>
                    <option value="1">左键</option>
                    <option value="2">右键</option>
                    <option value="3">全部</option>
                </select>
                <button type="button" class="btn btn-primary" id="saveClickSoundBtn">
                    <i class="fa fa-save"></i> 保存
                </button>
            </div>
            <small style="display: block; margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.85rem;">选择点击时是否播放音效，保存后需要点击"立即生效"按钮</small>
        </div>

        
        <div class="content-card">
            <h2><i class="fa fa-th-large"></i> 系统图标列表</h2>

            <div id="iconsList" class="icons-grid-container">
                
                <div class="loading-state">
                    <i class="fa fa-spinner fa-spin" style="font-size: 2rem; margin-right: 1rem;"></i>
                    加载中...
                </div>
            </div>
        </div>
    </div>

    
    <div id="overlay" class="overlay hidden"></div>
    <div id="statusMessage" class="status-message hidden">
        <i class="fa fa-info-circle"></i>
        <p id="statusMessageText">操作进行中...</p>
    </div>

    
    <div id="applyConfigModal" class="overlay" style="display: none; justify-content: center; align-items: center;">
        <div style="background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 0.8rem; padding: 2rem; max-width: 500px; width: 90%; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);">
            <h3 style="color: var(--primary); margin-bottom: 1rem; text-align: center;">应用配置确认</h3>
            <p style="margin-bottom: 2rem; text-align: center; color: var(--text-secondary);">
                应用配置将重启程序以使其生效，确定要继续吗？
            </p>
            <div style="display: flex; justify-content: center; gap: 1rem;">
                <button id="cancelApplyBtn" class="btn btn-secondary">
                    取 消
                </button>
                <button id="confirmApplyBtn" class="btn btn-primary">
                    确 定
                </button>
            </div>
        </div>
    </div>

    <link rel="stylesheet" href="fonts/font-awesome.min.css">
    <script>function sha256(e){function t(e,t){return e>>>t|e<<32-t}var n=Math.pow;var o=n(2,32);var i="length";var a,s;var c="";var r=[];var d=e[i]*8;var l=sha256.h=sha256.h||[];var m=sha256.k=sha256.k||[];var f=m[i];var p={};for(var u=2;f<64;u++){if(!p[u]){for(a=0;a<313;a+=u){p[a]=u}l[f]=n(u,.5)*o|0;m[f++]=n(u,1/3)*o|0}}e+="";while(e[i]%64-56)e+="\0";for(a=0;a<e[i];a++){s=e.charCodeAt(a);if(s>>8)return;r[a>>2]|=s<<(3-a)%4*8}r[r[i]]=d/o|0;r[r[i]]=d;for(s=0;s<r[i];){var h=r.slice(s,s+=16);var g=l;l=l.slice(0,8);for(a=0;a<64;a++){var y=a+s;var w=h[a-15],x=h[a-2];var v=l[0],b=l[4];var k=l[7]+(t(b,6)^t(b,11)^t(b,25))+(b&l[5]^~b&l[6])+m[a]+(h[a]=a<16?h[a]:h[a-16]+(t(w,7)^t(w,18)^w>>>3)+h[a-7]+(t(x,17)^t(x,19)^x>>>10)|0);var I=(t(v,2)^t(v,13)^t(v,22))+(v&l[1]^v&l[2]^l[1]&l[2]);l=[k+I|0].concat(l);l[4]=l[4]+k|0}for(a=0;a<8;a++){l[a]=l[a]+g[a]|0}}for(a=0;a<8;a++){for(s=3;s+1;s--){var E=l[a]>>s*8&255;c+=(E<16?0:"")+E.toString(16)}}return c}function checkLoginStatus(){const e=localStorage.getItem("authToken");const t=localStorage.getItem("loginTimestamp");const n=30*60*1e3;const o=(new Date).getTime();if(!e||!t||o-parseInt(t)>n){localStorage.removeItem("authToken");localStorage.removeItem("loginTimestamp");localStorage.removeItem("isLoggedIn");localStorage.setItem("returnUrl",window.location.href);window.location.href="login.html";return false}localStorage.setItem("authToken","authenticated");localStorage.setItem("loginTimestamp",o.toString());return true}function showStatusMessage(e,t){const n=document.getElementById("statusMessage");const o=document.getElementById("statusMessageText");const i=document.getElementById("overlay");const a=n.querySelector("i");n.className="status-message "+e;o.textContent=t;if(e==="success"){a.className="fa fa-check-circle"}else if(e==="error"){a.className="fa fa-exclamation-circle"}else{a.className="fa fa-info-circle"}n.style.display="block";i.style.display="block"}function hideStatusMessage(){const e=document.getElementById("statusMessage");const t=document.getElementById("overlay");e.style.display="none";t.style.display="none"}function showNotification(e,t="info"){let n=document.getElementById("notification-container");if(!n){n=document.createElement("div");n.id="notification-container";n.style.position="fixed";n.style.top="20px";n.style.right="20px";n.style.zIndex="99999";n.style.maxWidth="300px";document.body.appendChild(n)}const o=document.createElement("div");o.className="notification "+t;o.innerHTML=`
                <div class="notification-info">
                    <div class="notification-icon">
                        <i class="fa fa-${t==="success"?"check-circle":t==="error"?"exclamation-circle":"info-circle"}"></i>
                    </div>
                    <div class="notification-content">
                        <h4>${t==="success"?"成功":t==="error"?"错误":t==="warning"?"警告":"信息"}</h4>
                        <p>${e}</p>
                    </div>
                </div>
            `;n.appendChild(o);setTimeout(()=>{o.classList.add("fade-out");setTimeout(()=>{if(n.contains(o)){n.removeChild(o)}},300)},2e3)}function saveToJson(e,o){return new Promise((t,n)=>{fetch("./api/save-settings",{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":"authenticated"},body:JSON.stringify({key:e,value:o})}).then(e=>{if(!e.ok){throw new Error("保存失败")}return e.json()}).then(e=>{if(e.success){t()}else{n(new Error(e.message||"保存失败"))}}).catch(e=>{n(e)})})}async function loadIcons(){const t=document.getElementById("iconsList");t.innerHTML=`
                <tr>
                    <td colspan="4" style="text-align: center; padding: 2rem;">
                        <i class="fa fa-spinner fa-spin" style="font-size: 2rem; margin-right: 1rem;"></i>
                        加载中...
                    </td>
                </tr>
            `;try{const e=await scanIconsDirectory();if(e.length===0){t.innerHTML=`
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 2rem;">
                                <i class="fa fa-exclamation-circle text-warning" style="font-size: 2rem; margin-right: 1rem;"></i>
                                暂无图标数据
                            </td>
                        </tr>
                    `;return}const n=e.map(e=>({id:e.name,name:e.title||e.name,previewUrl:`res/tow/static/app/icons/${e.name}/icon.png`,customPath:""}));renderIconsList(n)}catch(e){console.error("扫描图标目录失败:",e);showNotification("扫描图标目录失败","error");t.innerHTML=`
                    <div class="empty-state">
                        <i class="fa fa-exclamation-circle" style="font-size: 2rem; margin-right: 1rem;"></i>
                        无法加载图标数据，请刷新页面重试
                    </div>
                `}}function scanIconsDirectory(){return new Promise((t,n)=>{fetch("./sysico.json").then(e=>{if(!e.ok){throw new Error(`HTTP error! Status: ${e.status}`)}return e.json()}).then(e=>{t(e)}).catch(e=>{console.error("读取目录配置文件失败:",e);showNotification("读取目录配置文件失败，请刷新页面重试","error");n(e)})})}function renderIconsList(e){const t=document.getElementById("iconsList");t.innerHTML="";if(e.length===0){t.innerHTML=`
                    <div class="empty-state">
                        <i class="fa fa-exclamation-circle text-warning" style="font-size: 2rem; margin-right: 1rem;"></i>
                        暂无图标数据
                    </div>
                `;return}if(!document.querySelector("#sysico-theme-vars")){const n=document.createElement("style");n.id="sysico-theme-vars";n.textContent=`
                :root {
                    --primary: #00a8ff;
                    --secondary: #00d2d3;
                    --accent: #5f27cd;
                    --success: #10ac84;
                    --danger: #ee5a24;
                    --warning: #feca57;
                    --info: #3498db;
                    --dark-bg: #0f172a;
                    --card-bg: #1e293b;
                    --card-hover: #273449;
                    --border-color: #334155;
                    --text-primary: #e2e8f0;
                    --text-secondary: #94a3b8;
                    --shadow-color: rgba(0, 0, 0, 0.3);
                    --glow-primary: 0 0 10px rgba(0, 168, 255, 0.5);
                    --glow-secondary: 0 0 15px rgba(0, 210, 211, 0.3);
                }
                
                .loading-state,
                .empty-state {
                    grid-column: 1 / -1;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    padding: 2rem;
                    text-align: center;
                    color: var(--text-secondary);
                    font-size: 1.1rem;
                }
                

                

            `;document.head.appendChild(n)}const o=document.createElement("div");o.className="icon-grid";e.forEach(e=>{const t=document.createElement("div");t.className="anime-card";t.dataset.iconId=e.id;const n=localStorage.getItem(`icon_selected_${e.id}`)==="true";t.innerHTML=`
                    <div class="anime-cover">
                        <img src="${e.previewUrl}" alt="${e.name}" class="anime-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22300%22 viewBox=%220 0 200 300%22%3E%3Crect width=%22200%22 height=%22300%22 fill=%22%232d3748%22/%3E%3Ctext x=%22100%22 y=%22150%22 font-family=%22Arial%22 font-size=%2240%22 fill=%22%23a0aec0%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22%3E?%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="anime-info" style="text-align: center;">
                        <h3 class="anime-title">${e.name}</h3>
                        <div class="anime-actions">
                            <button class="anime-default-btn" onclick="resetToDefault('${e.id}')">
                                默认
                            </button>
                            <button class="anime-upload-btn" onclick="triggerFileUpload('${e.id}')">
                                上传
                            </button>
                        </div>
                    </div>
                    <input type="file" id="fileInput_${e.id}" style="display: none;" accept="image/*" onchange="handleFileUpload('${e.id}', this.files[0])">
                `;o.appendChild(t)});t.appendChild(o);if(!document.querySelector("#sysico-icon-grid-styles")){const i=document.createElement("style");i.id="sysico-icon-grid-styles";i.textContent=`
                    /* 自适应网格布局 - 按明确的断点和列数要求设置 */
                    .icon-grid {
                        display: grid;
                        grid-template-columns: 1fr; /* 默认1列 */
                        gap: 12px;
                        padding: 10px;
                        width: 100%;
                    }
                    
                    /* 500px以上显示2列 */
                    @media (min-width: 530px) {
                        .icon-grid {
                            grid-template-columns: 1fr 1fr;
                            gap: 16px;
                            padding: 15px;
                        }
                    }
                    
                    /* 700px以上显示3列 */
                    @media (min-width: 740px) {
                        .icon-grid {
                            grid-template-columns: repeat(3, 1fr);
                            gap: 18px;
                            padding: 20px;
                        }
                    }
                    
                    /* 880px以上显示4列 */
                    @media (min-width: 940px) {
                        .icon-grid {
                            grid-template-columns: repeat(4, 1fr);
                            gap: 20px;
                            padding: 22px;
                        }
                    }
                    
                    /* 1080px以上显示5列 */
                    @media (min-width: 1160px) {
                        .icon-grid {
                            grid-template-columns: repeat(5, 1fr);
                            gap: 24px;
                            padding: 24px;
                        }
                    }
                    
                    /* 动漫风格卡片 - 进一步减小整体大小 */
                    .anime-card {
                        background: #1a1a2e;
                        border: 3px solid rgba(255, 255, 255, 0.1);
                        border-radius: 30px;
                        overflow: hidden;
                        transition: all 0.3s ease;
                        position: relative;
                        height: 178px;
                        display: flex;
                        flex-direction: column;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                        /* 悬空效果 */
                        transform: translateY(0);
                    }
                    
                    .anime-card:hover {
                        transform: translateY(-10px) scale(1.02);
                        box-shadow: 0 16px 48px rgba(67, 97, 238, 0.4);
                        border-color: rgba(255, 255, 255, 0.3);
                    }
                    
                    /* 封面区域 - 适配更小的卡片 */
                    .anime-cover {
                        position: relative;
                        width: 100%;
                        height: 120px;
                        overflow: hidden;
                        display: flex;
                        align-items: flex-end;
                        justify-content: center;
                        padding-bottom: 0px;
                        margin-top: 10px;
                    }
                    
                    /* 预览图片调整位置并增大，为弹跳动画预留更多空间 */
                    .anime-cover img {
                        width: 80%;
                        height: 80%;
                        object-fit: contain;
                        animation: bounce 3s ease-in-out infinite;
                    }
                    
                    /* 弹跳动画效果 */
                    @keyframes bounce {
                        0%, 100% {
                            transform: translateY(0) scale(1);
                        }
                        25% {
                            transform: translateY(-10px) scale(1.05);
                        }
                        50% {
                            transform: translateY(0) scale(1);
                        }
                        75% {
                            transform: translateY(-10px) scale(1.05);
                        }
                    }
                    
                    /* 随机延迟动画，让不同图标弹跳时间错开 */
                    .anime-cover:nth-child(1) img {
                        animation-delay: 0s;
                    }
                    .anime-cover:nth-child(2) img {
                        animation-delay: 0.3s;
                    }
                    .anime-cover:nth-child(3) img {
                        animation-delay: 0.6s;
                    }
                    .anime-cover:nth-child(4) img {
                        animation-delay: 0.9s;
                    }
                    
                    /* 已移除阴影遮盖效果 */
                    
                    /* 动漫图片 */
                    .anime-image {
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        transition: transform 0.5s ease;
                    }
                    
                    .anime-card:hover .anime-image {
                        transform: scale(1.05);
                    }
                    
                    /* 信息区域 */
                    .anime-info {
                        padding: 0px 12px 12px 12px;
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        justify-content: space-between;
                    }
                    
                    /* 动漫标题 */
                    .anime-title {
                        color: white;
                        font-size: 1rem;
                        font-weight: 600;
                        margin: 0 0 10px 0;
                        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
                        line-height: 1.3;
                        display: -webkit-box;
                        -webkit-line-clamp: 2;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                    }
                    
                    /* 操作按钮区域 */
                    .anime-actions {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    
                    /* 选择按钮 - 动漫风格 */
                    .anime-select-btn {
                        background: linear-gradient(135deg, #4361ee, #3f37c9);
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 20px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                        flex: 1;
                        justify-content: center;
                        margin-right: 8px;
                    }
                    
                    .anime-select-btn:hover {
                        background: linear-gradient(135deg, #3a0ca3, #4361ee);
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4);
                    }
                    
                    /* 已选择状态 */
                    .anime-select-btn.selected {
                        background: linear-gradient(135deg, #4cc9f0, #4361ee);
                        box-shadow: 0 0 15px rgba(76, 201, 240, 0.6);
                    }
                    
                    .anime-select-btn .fa-check {
                        opacity: 0;
                        transform: translateX(10px);
                        transition: all 0.3s ease;
                    }
                    
                    .anime-select-btn.selected .fa-check {
                        opacity: 1;
                        transform: translateX(0);
                    }
                    
                     /* 按钮样式 - 大小一致 */
                    .anime-default-btn,
                    .anime-upload-btn {
                        flex: 1;
                        background: linear-gradient(135deg, #ff5c8d, #ff2e63);
                        color: white;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 20px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 6px;
                        font-size: 0.85rem;
                    }
                    
                    .anime-default-btn {
                        margin-right: 8px;
                    }
                    
                    .anime-upload-btn {
                        background: linear-gradient(135deg, #4361ee, #3f37c9);
                    }
                    
                    .anime-default-btn:hover {
                        background: linear-gradient(135deg, #e04a7a, #ff2e63);
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(255, 92, 141, 0.4);
                    }
                    
                    .anime-upload-btn:hover {
                        background: linear-gradient(135deg, #3a0ca3, #4361ee);
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4);
                    }
                    
                    .anime-upload-btn:hover {
                        background: linear-gradient(135deg, #3a0ca3, #4361ee);
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4);
                    }
                    
                    /* 确保容器正确显示 */
                    #iconsList {
                        display: block;
                        width: 100%;
                        border: none;
                        background: transparent;
                    }
                `;document.head.appendChild(i)}}function showNotification(e,t="info"){const n=document.getElementById("notification");const o=document.getElementById("notificationText");o.textContent=e;n.className="notification";n.classList.add(`notification-${t}`);n.style.display="block";setTimeout(()=>{n.style.display="none"},3e3)}function showCustomConfirm(e,t,n,o){const i=document.createElement("div");i.className="custom-confirm-overlay";i.innerHTML=`
                <div class="custom-confirm-dialog">
                    <div class="custom-confirm-header">
                        <h3>${e}</h3>
                        <div class="tech-glow"></div>
                    </div>
                    <div class="custom-confirm-content">
                        <div class="tech-icon">
                            <i class="fa fa-refresh fa-spin"></i>
                        </div>
                        <p>${t}</p>
                    </div>
                    <div class="custom-confirm-actions">
                        <button class="custom-btn cancel-btn" onclick="hideCustomConfirm()">取消</button>
                        <button class="custom-btn confirm-btn" onclick="hideCustomConfirm(true, '${o}')">确认</button>
                    </div>
                </div>
            `;window.customConfirmCallback=n;const a=document.createElement("style");a.textContent=`
                .custom-confirm-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.7);
                    backdrop-filter: blur(5px);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    font-family: 'Arial', sans-serif;
                }
                
                .custom-confirm-dialog {
                    background: #1a1a2e;
                    border-radius: 12px;
                    border: 1px solid #3a3a5e;
                    width: 90%;
                    max-width: 450px;
                    overflow: hidden;
                    box-shadow: 0 8px 32px rgba(0, 191, 255, 0.15);
                    position: relative;
                    animation: dialogSlideIn 0.3s ease-out;
                }
                
                @keyframes dialogSlideIn {
                    from {
                        opacity: 0;
                        transform: translateY(-20px) scale(0.95);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0) scale(1);
                    }
                }
                
                .custom-confirm-header {
                    background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
                    padding: 20px;
                    position: relative;
                    overflow: hidden;
                }
                
                .custom-confirm-header h3 {
                    color: #00f2fe;
                    margin: 0;
                    font-size: 18px;
                    font-weight: 500;
                    position: relative;
                    z-index: 2;
                    text-align: center;
                }
                
                .tech-glow {
                    position: absolute;
                    top: -50%;
                    left: -50%;
                    width: 200%;
                    height: 200%;
                    background: radial-gradient(circle, rgba(0, 242, 254, 0.2) 0%, transparent 70%);
                    animation: glowPulse 2s infinite alternate;
                    z-index: 1;
                }
                
                @keyframes glowPulse {
                    from { opacity: 0.3; }
                    to { opacity: 0.6; }
                }
                
                .custom-confirm-content {
                    padding: 25px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                }
                
                .tech-icon {
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #00f2fe 0%, #4facfe 100%);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #1a1a2e;
                    font-size: 20px;
                    flex-shrink: 0;
                }
                
                .custom-confirm-content p {
                    color: #e9e9f0;
                    margin: 0;
                    font-size: 16px;
                    line-height: 1.5;
                }
                
                .custom-confirm-actions {
                    background: #16213e;
                    padding: 15px 20px;
                    display: flex;
                    justify-content: flex-end;
                    gap: 10px;
                    border-top: 1px solid #3a3a5e;
                }
                
                .custom-btn {
                    padding: 10px 20px;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    position: relative;
                    overflow: hidden;
                }
                
                .cancel-btn {
                    background: transparent;
                    color: #e9e9f0;
                    border: 1px solid #3a3a5e;
                }
                
                .cancel-btn:hover {
                    background: rgba(233, 233, 240, 0.1);
                    border-color: #4a4a6e;
                }
                
                .confirm-btn {
                    background: linear-gradient(135deg, #00f2fe 0%, #4facfe 100%);
                    color: #1a1a2e;
                    font-weight: 600;
                }
                
                .confirm-btn:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 4px 12px rgba(0, 242, 254, 0.3);
                }
                
                .confirm-btn::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    width: 0;
                    height: 0;
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 50%;
                    transform: translate(-50%, -50%);
                    transition: width 0.6s, height 0.6s;
                }
                
                .confirm-btn:active::after {
                    width: 300px;
                    height: 300px;
                }
            `;document.head.appendChild(a);document.body.appendChild(i)}function hideCustomConfirm(e=false,t=null){const n=document.querySelector(".custom-confirm-overlay");const o=document.querySelector("style:has(.custom-confirm-overlay)");if(n){n.style.opacity="0";n.style.transition="opacity 0.3s ease";setTimeout(()=>{if(n.parentNode){n.parentNode.removeChild(n)}if(o&&o.parentNode){o.parentNode.removeChild(o)}if(e&&window.customConfirmCallback&&t){window.customConfirmCallback(t)}window.customConfirmCallback=null},300)}}function resetToDefault(e){showCustomConfirm("图标重置确认","确定要将此图标重置为默认状态吗？",performIconReset,e)}function performIconReset(n){showStatusMessage("info","正在恢复默认图标...");fetch(`./api/restore-default-icon?directory=${n}`).then(e=>e.json()).then(e=>{hideStatusMessage();if(e.success){showNotification("默认图标已恢复","success");const t=document.querySelector(`div[data-icon-id="${n}"] img`);t.src=`res/tow/static/app/icons/${n}/icon.png?${(new Date).getTime()}`;fetch(`./api/delete-sysico-file?iconId=${n}`).then(e=>e.json()).then(e=>{if(!e.success&&e.message){console.warn("删除sysico文件时出现警告:",e.message)}}).catch(e=>{console.warn("删除sysico文件时发生错误:",e)})}else{showNotification(e.message||"恢复默认图标失败","error")}}).catch(e=>{hideStatusMessage();console.error("恢复默认图标失败:",e);showNotification("恢复默认图标时发生错误","error")})}function triggerFileUpload(e){document.getElementById(`fileInput_${e}`).click()}function handleFileUpload(n,o){if(!o)return;showStatusMessage("info","正在备份当前图标...");fetch(`./api/backup-icon?directory=${n}`).then(e=>e.json()).then(e=>{if(!e.success){hideStatusMessage();showNotification(e.message||"备份图标失败","error");return Promise.reject(new Error("备份失败"))}showStatusMessage("info","上传中...");const t=new FileReader;t.onload=function(e){fetch(`./api/upload-icon?directory=${n}`,{method:"POST",headers:{"Content-Type":o.type||"image/png"},body:e.target.result}).then(e=>e.json()).then(e=>{hideStatusMessage();if(e.success){showNotification("图标上传成功","success");const t=document.querySelector(`div[data-icon-id="${n}"] img`);t.src=`res/tow/static/app/icons/${n}/icon.png?${(new Date).getTime()}`}else{showNotification(e.message||"图标上传失败","error")}}).catch(e=>{hideStatusMessage();console.error("上传图标失败:",e);showNotification("图标上传时发生错误","error")})};t.readAsArrayBuffer(o)}).catch(e=>{hideStatusMessage();console.error("备份图标失败:",e)})}function syncAllIcons(){showNotification("正在同步图标...","info");showStatusMessage("info","正在同步图标到目标目录，请稍候...");fetch("./api/sync-icons").then(e=>e.json()).then(e=>{hideStatusMessage();if(e.success){showNotification(`图标同步成功，成功: ${e.successFiles.length}, 失败: ${e.failedFiles.length}`,"success");if(e.failedFiles.length>0){console.warn("部分图标同步失败:",e.failedFiles)}}else{showNotification(e.message||"图标同步失败","error")}}).catch(e=>{hideStatusMessage();console.error("同步图标失败:",e);showNotification("图标同步时发生错误","error")})}document.addEventListener("DOMContentLoaded",function(){fetch("deskdata/fnstyle.json?v="+(new Date).getTime()).then(e=>e.json()).then(e=>{if(e.sysicoDisplay){document.getElementById("sysicoDisplay").value=e.sysicoDisplay}if(e.fndeskMP3_name){document.getElementById("mp3Name").value=e.fndeskMP3_name}if(e.fndeskMP3_ico){document.getElementById("mp3Icon").value=e.fndeskMP3_ico}if(e.fndeskMP3){document.getElementById("mp3Path").value=e.fndeskMP3}if(e.fndeskClickSound!==undefined){document.getElementById("clickSoundSelect").value=e.fndeskClickSound}}).catch(e=>console.error("读取fnstyle.json失败:",e))});document.getElementById("saveSysicoDisplayBtn").addEventListener("click",function(){const e=document.getElementById("sysicoDisplay").value;let t=e.trim().replace(/[\r\n]+/g,",").replace(/^,|,$/g,"").replace(/，/g,",").replace(/,+/g,",").trim();document.getElementById("sysicoDisplay").value=t;showCustomConfirm("保存确认","确定要保存隐藏图标设置吗？",function(){fetch("api/fnstyle.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sysicoDisplay:t})}).then(e=>{if(!e.ok){throw new Error("网络响应错误")}return e.json()}).then(()=>{showNotification("保存成功！","success")}).catch(e=>{console.error("保存失败:",e);showNotification("保存失败，请重试","error")})},"saveSysicoDisplay")});function refreshIcons(){showNotification("正在刷新图标列表...","info");loadIcons()}document.getElementById("fndeskAppIcon").addEventListener("change",function(e){const t=e.target.files[0];if(t){const n=new FileReader;n.onload=function(e){const t=document.getElementById("fndeskAppIconPreview");t.innerHTML=`<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: contain;">`};n.readAsDataURL(t)}});document.getElementById("fndeskAppIconPreview").addEventListener("click",function(){document.getElementById("fndeskAppIcon").click()});document.getElementById("generateFndeskAppBtn").addEventListener("click",function(){const n=document.getElementById("fndeskAppName").value.trim();const o=document.getElementById("fndeskAppType").value;const i=document.getElementById("fndeskAppDefaultUrl").value.trim();const a=document.getElementById("fndeskAppPublicUrl").value.trim();if(!n){showNotification("请输入图标名字","error");return}if(!i){showNotification("请输入默认地址","error");return}const t=document.getElementById("fndeskAppIcon").files[0];if(!t){showNotification("请上传图标图片","error");return}showCustomConfirm("生成确认","确定要生成飞牛原生图标吗？",function(){const e=new FormData;e.append("file",t);showStatusMessage("info","正在上传图标...");fetch("./api/upload/fndesk-app-icon",{method:"POST",headers:{"x-auth-token":"authenticated"},body:e}).then(e=>e.json()).then(e=>{if(e.success){hideStatusMessage();showNotification("图标上传成功，正在生成配置...");const t={appName:n,appType:o,appDefaultUrl:i,appPublicUrl:a};showStatusMessage("info","正在生成飞牛原生图标...");fetch("./api/generate-fndesk-app",{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":"authenticated"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{hideStatusMessage();if(e.success){showNotification("飞牛原生图标生成成功！","success");document.getElementById("fndeskAppName").value="";document.getElementById("fndeskAppIcon").value="";document.getElementById("fndeskAppType").value="iframe";document.getElementById("fndeskAppDefaultUrl").value="";document.getElementById("fndeskAppPublicUrl").value="";const t=document.getElementById("fndeskAppIconPreview");t.innerHTML='<i class="fa fa-image" style="font-size: 24px; color: var(--text-secondary);"></i>'}else{showNotification("生成配置失败: "+e.message,"error")}}).catch(e=>{hideStatusMessage();console.error("生成配置失败:",e);showNotification("生成配置失败: "+e.message,"error")})}else{hideStatusMessage();showNotification("上传图标失败: "+e.message,"error")}}).catch(e=>{hideStatusMessage();console.error("上传图标失败:",e);showNotification("上传图标失败: "+e.message,"error")})},"generateFndeskApp")});document.addEventListener("DOMContentLoaded",function(){if(!checkLoginStatus()){return}loadIcons();document.getElementById("saveMp3NameBtn").addEventListener("click",function(){const e=document.getElementById("mp3Name").value.trim();showCustomConfirm("保存确认","确定要保存播放器标题吗？",function(){fetch("api/fnstyle.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fndeskMP3_name:e})}).then(e=>e.json()).then(e=>{if(e.success){showNotification("播放器标题保存成功！","success")}else{showNotification("保存失败，请重试","error")}}).catch(e=>{console.error("保存播放器标题失败:",e);showNotification("保存失败，请重试","error")})},"saveMp3Name")});document.getElementById("saveMp3IconBtn").addEventListener("click",function(){const e=document.getElementById("mp3Icon").value.trim();showCustomConfirm("保存确认","确定要保存播放器图标吗？",function(){fetch("api/fnstyle.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fndeskMP3_ico:e})}).then(e=>e.json()).then(e=>{if(e.success){showNotification("播放器图标保存成功！","success")}else{showNotification("保存失败，请重试","error")}}).catch(e=>{console.error("保存播放器图标失败:",e);showNotification("保存失败，请重试","error")})},"saveMp3Icon")});document.getElementById("saveMp3PasswordBtn").addEventListener("click",function(){const t=document.getElementById("mp3Password").value.trim();showCustomConfirm("保存确认","确定要保存播放器密码吗？",function(){const e=sha256(t);fetch("api/fnstyle.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fndeskMP3_PW:e})}).then(e=>e.json()).then(e=>{if(e.success){showNotification("播放器密码保存成功！","success");document.getElementById("mp3Password").value=""}else{showNotification("保存失败，请重试","error")}}).catch(e=>{console.error("保存播放器密码失败:",e);showNotification("保存失败，请重试","error")})},"saveMp3Password")});document.getElementById("triggerMp3IconUploadBtn").addEventListener("click",function(){document.getElementById("mp3IconUpload").click()});document.getElementById("mp3IconUpload").addEventListener("change",function(e){const t=e.target.files[0];if(!t)return;const n=new FormData;n.append("file",t);showStatusMessage("info","正在上传图标...");fetch("./api/upload/fndeskMP3_ico",{method:"POST",body:n}).then(e=>e.json()).then(e=>{hideStatusMessage();if(e.success){const t=e.url||e.filePath;document.getElementById("mp3Icon").value=t;showNotification("图标上传成功！","success");document.getElementById("saveMp3IconBtn").click()}else{showNotification("图标上传失败: "+(e.error||"未知错误"),"error")}}).catch(e=>{hideStatusMessage();console.error("图标上传失败:",e);showNotification("图标上传失败，请重试","error")})});document.getElementById("saveClickSoundBtn").addEventListener("click",function(){const e=document.getElementById("clickSoundSelect").value;showCustomConfirm("保存确认","确定要保存点击音效设置吗？",function(){fetch("api/fnstyle.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fndeskClickSound:parseInt(e)})}).then(e=>e.json()).then(e=>{if(e.success){showNotification("点击音效设置保存成功！","success")}else{showNotification("保存失败，请重试","error")}}).catch(e=>{console.error("保存点击音效失败:",e);showNotification("保存失败，请重试","error")})},"saveClickSound")});document.getElementById("saveMp3PathBtn").addEventListener("click",function(){const e=document.getElementById("mp3Path").value.trim();showCustomConfirm("保存确认","确定要保存音乐路径吗？",function(){fetch("api/fnstyle.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fndeskMP3:e})}).then(e=>e.json()).then(e=>{if(e.success){showNotification("音乐路径保存成功！","success")}else{showNotification("保存失败，请重试","error")}}).catch(e=>{console.error("保存音乐路径失败:",e);showNotification("保存失败，请重试","error")})},"saveMp3Path")});const e=document.getElementById("applyBtn");const o=document.getElementById("applyConfigModal");const t=document.getElementById("cancelApplyBtn");const n=document.getElementById("confirmApplyBtn");if(e&&o){e.addEventListener("click",e=>{e.preventDefault();o.style.display="flex"})}if(t&&o){t.addEventListener("click",()=>{o.style.display="none"})}if(o){o.addEventListener("click",e=>{if(e.target===o){o.style.display="none"}})}if(n&&o){n.addEventListener("click",async()=>{try{const e=document.createElement("iframe");e.id="loadingIframe";e.src="./loading.html";e.style.cssText=`
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         border: none;
         z-index: 9999;
     `;document.body.appendChild(e);o.style.display="none";const t=await fetch("./api/update-data",{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":"authenticated"},body:JSON.stringify({filePath:"deskdata/pw.json",update:{enabled:1}})});if(!t.ok){throw new Error("更新配置数据失败")}const n=await fetch("./api/exit",{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":"authenticated"}});if(n.ok){showNotification("系统配置即将开始...","success")}else{throw new Error("重启请求失败")}}catch(e){console.error("应用配置失败:",e);showNotification("应用配置失败，请重试","error")}})}})</script>

    
    <footer>
        <div class="container text-center" style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
            <p style="font-size: 13px; margin: 0 0 0.5rem 0; color: var(--text-secondary);">飞牛桌面管理工具 by 米恋泥</p>
            <p style="font-size: 12px; margin: 0; color: var(--text-secondary);">组织机构 @小宠瞭望塔</p>
        </div>
    </footer>
</body>

</html>