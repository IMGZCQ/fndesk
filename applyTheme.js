function applyTheme(e){e.t1&&e.t2&&e.t3&&e.t4?(showNotification("正在下载并应用主题...","info"),e={loginLogoUrl:e.t1.replace(/[`']/g,""),loginBackgroundUrl:e.t2.replace(/[`']/g,""),desktopWallpaperUrl:e.t4.replace(/[`']/g,""),deviceLogoUrl:e.t3.replace(/[`']/g,"")},fetch("./api/select-theme",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(e.ok)return e.json();throw new Error("HTTP错误! 状态: "+e.status)}).then(e=>{if(!e.success)throw new Error(e.error||"主题应用失败");console.log("主题应用成功:",e.data),showNotification("主题选择成功，已更新配置"),loadCurrentSettings(),setTimeout(()=>{var e=document.getElementById("fn-personalization");if(e){e=e.offsetTop-100;let o=window.pageYOffset,n=e-o,r=3e3,i=null;requestAnimationFrame(function smoothScroll(e){var e=e-(i=i||e),t=function easeInOutQuad(e,t,o,n){return(e/=n/2)<1?o/2*e*e+t:-o/2*(--e*(e-2)-1)+t}(e,o,n,r);window.scrollTo(0,t),e<r&&requestAnimationFrame(smoothScroll)})}},500),setTimeout(()=>{"function"==typeof saveLoginBackground&&saveLoginBackground(),"function"==typeof saveLoginLogo&&saveLoginLogo(),"function"==typeof saveDeviceLogo&&saveDeviceLogo(),"function"==typeof saveDesktopWallpaper&&saveDesktopWallpaper()},500)}).catch(e=>{console.error("应用主题失败:",e),showNotification("主题应用失败: "+e.message,"error")})):showNotification("主题数据不完整，请重新更新主题库","error")}function initThemeButtons(){document.getElementById("themeGrid").addEventListener("click",function(e){if(e.target.closest(".theme-select-btn")){let t=e.target.closest(".theme-select-btn").closest(".theme-card").dataset.themeId;fetch("deskdata/theme.json?v="+(new Date).getTime()).then(e=>e.json()).then(e=>{e=e.find(e=>e.ID.toString()===t);e&&applyTheme(e)}).catch(e=>{console.error("获取主题数据失败:",e),showNotification("获取主题数据失败","error")})}})}