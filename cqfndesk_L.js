let globalData=null,retryCount=0,maxRetries=1e3,retryInterval=300,intervalnasNameDisplay,optimizedUrls=new Map,pingCompleted=!1,currentZIndex=1e4;function processUrlField(e){var t;return e&&"string"==typeof e?(t=e.trim(),/^\d/.test(t)?window.location.protocol+`//${window.location.hostname}:`+t:t):e}function setupSpecificElementsZIndexManagement(){function setupElementEvents(e){e.hasAttribute("data-z-index-managed")||(e.setAttribute("data-z-index-managed","true"),e.addEventListener("mousedown",handleElementInteraction,!0),e.addEventListener("focus",handleElementInteraction))}function handleElementInteraction(e){let n=0;document.querySelectorAll('[id^="url-window"], [id^="folder-window"], .trim-ui__app-layout--window, [id^="mp3-window-"]').forEach((e,t)=>{e.tagName&&e.tagName.toLowerCase(),e.className&&Array.from(e.classList).join(".");e=parseInt(e.style.zIndex)||0;e>n&&(n=e)});var t=this.id,t=(t||(t="element_"+Date.now()+"_"+Math.floor(1e3*Math.random()),this.id=t),parseInt(this.style.zIndex),n+1);(this.style.zIndex=t)>currentZIndex&&(currentZIndex=t)}!function processExistingElements(){document.querySelectorAll('[id^="url-window"], [id^="folder-window"], .trim-ui__app-layout--window, [id^="mp3-window-"]').forEach(e=>{setupElementEvents(e)})}();var e=new MutationObserver(function(e){for(var t of e)"childList"===t.type&&0<t.addedNodes.length&&t.addedNodes.forEach(e=>{1===e.nodeType&&(e.matches('[id^="url-window"], [id^="folder-window"], .trim-ui__app-layout--window, [id^="mp3-window-"]')&&(setupElementEvents(e),e.classList.contains("trim-ui__app-layout--window")||e.id&&e.id.startsWith("mp3-window-"))&&handleElementInteraction.call(e),0<(e=e.querySelectorAll('[id^="url-window"], [id^="folder-window"], .trim-ui__app-layout--window, [id^="mp3-window-"]')).length)&&e.forEach(e=>{setupElementEvents(e),e.classList.contains("trim-ui__app-layout--window")&&handleElementInteraction.call(e)})})});return e.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}),e}let trayContainer=null,minimizedWindows=new Map,trayHeight=48,trayItemWidth=120,iconSort=1,nasNameDisplay=1,openAPPInPage=1,fndeskMP3_ico="deskdata/img/i.png",fndeskMP3_name=" fndesk MP3Êí≠ÊîæÂô®",fndeskMP3_url="",fndeskClickSound=0;function createTrayContainer(){return trayContainer||((trayContainer=document.createElement("div")).id="tech-window-tray",trayContainer.style.position="fixed",trayContainer.style.bottom="0",trayContainer.style.left="80px",trayContainer.style.transform="none",trayContainer.style.width="fit-content",trayContainer.style.maxWidth="90%",trayContainer.style.minWidth="150px",trayContainer.style.height=trayHeight+"px",trayContainer.style.background="rgba(0, 0, 0, 0.3)",trayContainer.style.backdropFilter="blur(20px)",trayContainer.style.borderTop="1px solid #3a3a5a",trayContainer.style.borderLeft="1px solid #3a3a5a",trayContainer.style.borderRight="1px solid #3a3a5a",trayContainer.style.borderRadius="12px 12px 0 0",trayContainer.style.boxShadow="0 -2px 20px rgba(66, 153, 225, 0.3)",trayContainer.style.zIndex="0",trayContainer.style.display="flex",trayContainer.style.alignItems="center",trayContainer.style.padding="0 10px",trayContainer.style.gap="10px",trayContainer.style.overflowX="auto",trayContainer.style.overflowY="hidden",trayContainer.style.justifyContent="flex-start",document.body.appendChild(trayContainer)),trayContainer}function addToTray(n,e,t){ensureTrayExists();var i=document.getElementById("tray-item-"+n),i=(i&&trayContainer.contains(i)&&trayContainer.removeChild(i),document.createElement("div")),o=(i.id="tray-item-"+n,i.style.minWidth=trayItemWidth+"px",i.style.height=trayHeight-10+"px",i.style.background="rgba(0, 0, 0, 0.2)",i.style.border="1px solid #3a3a5a",i.style.borderRadius="6px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.padding="0 10px",i.style.cursor="pointer",i.style.transition="all 0.2s ease",i.style.overflow="hidden",i.style.whiteSpace="nowrap",i.style.textOverflow="ellipsis",i.style.color="#ffffff",i.style.fontWeight="bold",i.style.fontSize="14px",i.style.justifyContent="flex-start",document.createElement("img")),a=(o.src=getWindowIcon(n)||"deskdata/img/i.png",o.style.width="26px",o.style.height="26px",o.style.marginRight="8px",o.style.objectFit="contain",document.createElement("div")),l=(a.textContent=e,a.style.overflow="hidden",a.style.textOverflow="ellipsis",a.style.whiteSpace="nowrap",a.style.flex="1",document.createElement("div"));l.title="ÂÖ≥Èó≠",l.style.width="24px",l.style.height="24px",l.style.borderRadius="8px",l.style.background="rgba(255, 28, 28, 0.6)",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.color="#ffffff",l.style.fontSize="12px",l.style.cursor="pointer",l.style.marginLeft="6px",l.style.transition="all 0.2s ease",l.innerHTML="X",l.title="ÂÖ≥Èó≠Á™óÂè£",l.addEventListener("mouseenter",function(){this.style.background="rgba(255, 28, 28, 0.94)",this.style.transform="scale(1.1)"}),l.addEventListener("mouseleave",function(){this.style.background="rgba(255, 28, 28, 0.6)",this.style.transform="scale(1)"}),l.addEventListener("click",function(e){e.stopPropagation();let t=null;activeWindows[n]?t=activeWindows[n].element:minimizedWindows.get(n)&&(t=minimizedWindows.get(n).element),t&&t.remove(),removeFromTray(n),delete activeWindows[n],minimizedWindows.delete(n),currentActiveWindowId===n&&(currentActiveWindowId=null)}),i.appendChild(o),i.appendChild(a),i.appendChild(l),i.addEventListener("mouseenter",function(){this.style.background="rgba(66, 153, 225, 0.3)",this.style.borderColor="#4299e1"}),i.addEventListener("mouseleave",function(){this.style.background="rgba(66, 153, 225, 0.1)",this.style.borderColor="#3a3a5a"}),i.addEventListener("click",function(){restoreFromTray(n)}),minimizedWindows.set(n,{title:e,element:t,trayItem:i}),trayContainer.appendChild(i),trayContainer.style.display="flex",adjustTrayWidth()}function adjustTrayWidth(){var e,t=minimizedWindows.size;1===t?(e=trayItemWidth+20,trayContainer.style.width=e+"px"):1<t&&(trayContainer.style.width="fit-content")}function removeFromTray(e){var t=minimizedWindows.get(e);t&&t.trayItem&&(trayContainer.removeChild(t.trayItem),minimizedWindows.delete(e),adjustTrayWidth(),0===minimizedWindows.size)&&(trayContainer.style.display="none")}function restoreFromTray(o){let a=minimizedWindows.get(o);a&&a.element&&(a.element.style.display="flex",currentZIndex++,a.element.style.zIndex=currentZIndex,activeWindows[o]&&(activeWindows[o].inTray=!1),removeFromTray(o),setTimeout(()=>{var e=a.element.querySelector('div[style*="flex: 1"]');if(e){let n=e.querySelector("iframe");if(n&&(n.style.width="0",n.style.height="0",n.offsetHeight,n.style.width="100%",n.style.height="100%",o.startsWith("mp3-window-"))){function adjustIframeHeight(){try{var e,t=n.contentWindow.document.body.scrollHeight;0<t&&(n.style.height=t+"px",e=t+40,a.element.style.height=e+"px")}catch(e){console.warn("Êó†Ê≥ïËé∑ÂèñiframeÂÜÖÂÆπÈ´òÂ∫¶:",e)}}adjustIframeHeight();try{var t=new MutationObserver(function(e){adjustIframeHeight()}),i={childList:!0,subtree:!0,attributes:!0,characterData:!0};t.observe(n.contentWindow.document.body,i)}catch(e){console.warn("Êó†Ê≥ïÈáçÊñ∞ËÆæÁΩÆMutationObserver:",e)}e=a.element.querySelector("div:nth-child(1) div:nth-child(2) div:last-child");e&&e.addEventListener("click",function(){clearInterval(heightCheckInterval)})}}},0))}function ensureTrayExists(){trayContainer||createTrayContainer()}function initializeTraySystem(){ensureTrayExists(),trayContainer.style.display="none"}function createContextMenu(){let t=document.getElementById("tech-context-menu");var e;return t||((t=document.createElement("div")).id="tech-context-menu",t.style.position="fixed",t.style.background="rgba(20, 20, 30, 0.95)",t.style.border="1px solid #3a3a5a",t.style.borderRadius="8px",t.style.boxShadow="0 0 20px rgba(66, 153, 225, 0.5), 0 0 40px rgba(66, 153, 225, 0.3)",t.style.zIndex="9999",t.style.display="none",t.style.minWidth="150px",t.style.padding="3px 0",t.style.backdropFilter="blur(10px)",(e=document.createElement("div")).style.position="absolute",e.style.top="0",e.style.left="0",e.style.right="0",e.style.height="100%",e.style.background="linear-gradient(45deg, transparent 0%, rgba(66, 153, 225, 0.05) 50%, transparent 100%)",e.style.zIndex="-1",t.appendChild(e),document.body.appendChild(t),document.addEventListener("click",function(e){t.contains(e.target)||(t.style.display="none")}),t.addEventListener("contextmenu",function(e){e.preventDefault()})),t}function showCustomContextMenu(n,e){n.preventDefault();let i=createContextMenu();i.innerHTML="";var t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",t.style.height="100%",t.style.background="linear-gradient(45deg, transparent 0%, rgba(66, 153, 225, 0.05) 50%, transparent 100%)",t.style.zIndex="-1",i.appendChild(t),e.forEach(e=>{var t,n=document.createElement("div");n.className="context-menu-item",Object.assign(n.style,{padding:"10px 15px",color:"#e0e0ff",fontSize:"13px",cursor:"pointer",transition:"all 0.2s ease",position:"relative",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"8px"}),e.style&&Object.assign(n.style,e.style),"function"==typeof e.customContent?(e.customContent(n),n.addEventListener("click",function(){"function"==typeof e.onClick&&e.onClick(),i.style.display="none"})):(e.icon&&((t=document.createElement("img")).src=e.icon,Object.assign(t.style,{width:"16px",height:"16px",objectFit:"contain"}),n.appendChild(t)),t=document.createTextNode(e.text),n.appendChild(t),n.addEventListener("click",function(){"function"==typeof e.onClick&&e.onClick(),i.style.display="none"}),n.addEventListener("mouseenter",function(){this.style.background="rgba(66, 153, 225, 0.3)",this.style.color="#ffffff",this.style.transform="translateX(5px)"}),n.addEventListener("mouseleave",function(){this.style.background="transparent",this.style.color="#e0e0ff",this.style.transform="translateX(0)"})),i.appendChild(n)}),n.clientX;i.style.left="0px",i.style.top="-1000px",i.style.display="block",requestAnimationFrame(()=>{let e=n.clientX,t=n.clientY;e+i.offsetWidth>window.innerWidth&&(e=n.clientX-i.offsetWidth),t+i.offsetHeight>window.innerHeight&&(t=n.clientY-i.offsetHeight),e=Math.max(5,e),t=Math.max(5,t),i.style.left=e+"px",i.style.top=t+"px"})}fetch("deskdata/fnstyle.json?v="+(new Date).getTime()).then(e=>e.json()).then(e=>{iconSort=e.iconSort||1,nasNameDisplay=e.nasNameDisplay||1,fndeskMP3_ico=e.fndeskMP3_ico||"deskdata/img/i.png",fndeskMP3_name=e.fndeskMP3_name||" fndesk MP3Êí≠ÊîæÂô®",fndeskMP3_url=e.fndeskMP3||"",fndeskClickSound=e.fndeskClickSound,2===nasNameDisplay&&(clearInterval(intervalnasNameDisplay),intervalnasNameDisplay=setInterval(()=>{var e=document.querySelectorAll("p.select-none");0<e.length&&(e.forEach(e=>{var t=document.createElement("br");e.parentNode.insertBefore(t,e),e.remove()}),clearInterval(intervalnasNameDisplay))},100)),e.appTitle&&e.appTitle2&&"È£ûÁâõ fnOS"!==e.appTitle&&document.addEventListener("visibilitychange",function(){document.hidden?document.title=e.appTitle2:document.title=e.appTitle})}).catch(e=>console.error("ËØªÂèñfnstyle.jsonÂ§±Ë¥•:",e));let activeWindows={},currentActiveWindowId=null,windowIcons=(document.addEventListener("keydown",function(i){if("Escape"===i.key||27===i.keyCode){let e=null,t=0,n=null;for(var o in activeWindows){var a,l;activeWindows[o].inTray||(a=document.getElementById(o))&&"none"!==a.style.display&&(l=parseInt(a.style.zIndex)||0)>t&&(t=l,e=a,n=o)}e&&n&&(i=(i=(i=e.querySelector("div:nth-child(1)"))?i.querySelector("div:nth-child(1) div:nth-child(2)"):null)?i.textContent:"Á™óÂè£",initializeTraySystem(),ensureTrayExists(),addToTray(n,i,e),e.style.display="none","true"===e.dataset.hasFocus&&(e.dataset.hasFocus="false"),activeWindows[n]&&(activeWindows[n].inTray=!0),currentActiveWindowId===n)&&(currentActiveWindowId=null)}}),new Map);function getWindowIcon(e){return windowIcons.get(e)}function setWindowIcon(e,t){windowIcons.set(e,t)}function getIconForUrl(e){if(globalData&&globalData.icons)for(var t of globalData.icons)if(e.includes(t.domain))return t.iconUrl;return null}function openMP3Player(){for(let e in activeWindows){var t,n=activeWindows[e];if("mp3"===n.type&&"/MP3go/index.html"===n.url)return t=document.getElementById(e),void(n.inTray?restoreFromTray(e):t&&(addToTray(e,n.title,t),n.inTray=!0,t.style.display="none",currentActiveWindowId===e)&&(currentActiveWindowId=null))}let a="mp3-window-"+Date.now()+"-"+Math.floor(1e3*Math.random()),o=400,l=180,r=null,s=null;try{var d=localStorage.getItem("url-window-state-mp3_player");if(d){let{width:e,height:t,left:n,top:i}=JSON.parse(d);300<=e&&e<=window.innerWidth&&150<=t&&t<=window.innerHeight&&(o=e,l=t),void 0!==n&&void 0!==i&&(r=n,s=i)}}catch(e){console.warn("ËØªÂèñÊí≠ÊîæÂô®Á™óÂè£Áä∂ÊÄÅÁºìÂ≠òÂ§±Ë¥•:",e)}let c=document.createElement("div");c.id=a,c.style.position="absolute",c.style.background="rgba(241, 244, 249, 0.2)",c.style.border="0px solid rgb(210, 210, 210)",c.style.borderRadius="10px",c.style.boxShadow="0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05)",c.style.width=o+"px",c.style.height=l+"px",c.style.display="flex",c.style.flexDirection="column",currentZIndex++,c.style.zIndex=currentZIndex,c.style.backdropFilter="blur(2px)",c.addEventListener("mousedown",function(e){g||resizeInProgress||(currentActiveWindowId=a)});var d=window.innerWidth,e=window.innerHeight;let i=null!==r?r:(d-o)/2,y=null!==s?s:(e-l)/2;i=Math.max(65,Math.min(i,d-o)),y=Math.max(0,Math.min(y,e-l)),c.style.left=i+"px",c.style.top=y+"px";var d=document.createElement("div"),e=(d.style.height="40px",d.style.background="rgba(241, 244, 249, 0.5)",d.style.borderTopLeftRadius="8px",d.style.borderTopRightRadius="8px",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="space-between",d.style.padding="0 10px",d.style.cursor="move",document.createElement("div")),p=(e.style.display="flex",e.style.alignItems="center",e.style.gap="8px",document.createElement("img")),u=(p.src=fndeskMP3_ico,p.style.width="32px",p.style.height="32px",p.style.marginLeft="-4px",p.style.borderRadius="6px",p.style.objectFit="contain",document.createElement("div")),p=(u.style.color="#333333",u.style.fontSize="15px",u.style.fontWeight="bold",u.textContent=fndeskMP3_name,e.appendChild(p),e.appendChild(u),document.createElement("div"));function createWindowButton(e,t="",n="normal"){var i=document.createElement("div");return i.title=t,i.style.width="40px",i.style.height="40px",i.style.borderRadius="4px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.color="black",i.style.fontSize="18px",i.style.fontWeight=n,i.style.cursor="pointer",i.style.marginRight="2px",i.style.transition="background-color 0.2s ease",i.innerText=e,i.addEventListener("mouseenter",function(){this.style.background="√ó"===e?"rgba(255, 83, 112, 0.7)":"rgba(0, 0, 0, 0.1)"}),i.addEventListener("mouseleave",function(){this.style.background="transparent"}),i}p.style.display="flex",p.style.alignItems="center";u=createWindowButton("‚Üª","Âà∑Êñ∞È°µÈù¢");u.addEventListener("click",function(e){e.stopPropagation();e=c.querySelector("iframe");e&&(e.src=e.src)});let m=createWindowButton("‚àí","ÊúÄÂ∞èÂåñ","bold"),f=(m.addEventListener("click",function(e){e.stopPropagation(),initializeTraySystem(),ensureTrayExists(),addToTray(a,fndeskMP3_name,c),c.style.display="none"}),createWindowButton("√ó","ÂÖ≥Èó≠Á™óÂè£","bold"));f.addEventListener("click",function(e){e.stopPropagation();try{var t=parseInt(c.style.width),n=parseInt(c.style.height),i=parseInt(c.style.left),o=parseInt(c.style.top);isNaN(t)||isNaN(n)||isNaN(i)||isNaN(o)||localStorage.setItem("url-window-state-mp3_player",JSON.stringify({width:t,height:n,left:i,top:o}))}catch(e){console.warn("‰øùÂ≠òÊí≠ÊîæÂô®Á™óÂè£Áä∂ÊÄÅÂ§±Ë¥•:",e)}c.remove(),delete activeWindows[a],currentActiveWindowId===a&&(currentActiveWindowId=null)}),p.appendChild(u),p.appendChild(m),p.appendChild(f),d.appendChild(e),d.appendChild(p);u=document.createElement("div");u.style.flex="1",u.style.display="flex";let h=document.createElement("iframe");function adjustIframeHeight(){try{var e,t=h.contentWindow.document,n=Math.max(t.body.scrollHeight,t.body.offsetHeight,t.documentElement.clientHeight,t.documentElement.scrollHeight,t.documentElement.offsetHeight);0<n&&(h.style.height=n+"px",e=n+40,c.style.height=e+"px")}catch(e){console.warn("Êó†Ê≥ïËé∑ÂèñiframeÂÜÖÂÆπÈ´òÂ∫¶:",e)}}function handleMessage(e){if("adjustMP3PlayerHeight"===e.data.type)try{var t;0<e.data.height?(h.style.height=e.data.height+"px",t=e.data.height+40,c.style.height=t+"px"):adjustIframeHeight()}catch(e){console.warn("Êó†Ê≥ïË∞ÉÊï¥MP3Êí≠ÊîæÂô®È´òÂ∫¶:",e)}}h.src="/MP3go/index.html",h.style.width="100%",h.style.height="100%",h.style.border="none",h.style.background="transparent",h.onload=function(){adjustIframeHeight();let e=setInterval(adjustIframeHeight,200);try{let e=new MutationObserver(function(e){adjustIframeHeight()});var t={childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"],characterData:!0};e.observe(h.contentWindow.document.body,t),f.addEventListener("click",function(){e.disconnect()})}catch(e){console.warn("Êó†Ê≥ïËÆæÁΩÆMutationObserver:",e)}f.addEventListener("click",function(){clearInterval(e)}),m.addEventListener("click",function(){clearInterval(e)})},u.appendChild(h),window.addEventListener("message",handleMessage),f.addEventListener("click",function(){window.removeEventListener("message",handleMessage)}),m.addEventListener("click",function(){window.removeEventListener("message",handleMessage)});let g=!1,x,v,w=(d.addEventListener("mousedown",function(e){var t;function handleMouseMove(e){var t,n,i;g&&(t=e.clientX-x,e=e.clientY-v,n=window.innerWidth,i=window.innerHeight,n=n-c.offsetWidth,i=i-c.offsetHeight,c.style.left=Math.max(65,Math.min(t,n))+"px",c.style.top=Math.max(0,Math.min(e,i))+"px")}function handleMouseUp(e){g&&(g=!1,document.body.style.cursor="",document.body.style.overflow="",h&&(h.style.pointerEvents="auto"),document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("mouseup",handleMouseUp),document.removeEventListener("mouseleave",handleMouseUp))}e.target!==f&&(g=!0,t=c.getBoundingClientRect(),x=e.clientX-t.left,v=e.clientY-t.top,currentZIndex++,c.style.zIndex=currentZIndex,document.body.style.cursor="move",document.body.style.overflow="hidden",h&&(h.style.pointerEvents="none"),document.addEventListener("mousemove",handleMouseMove),document.addEventListener("mouseup",handleMouseUp),document.addEventListener("mouseleave",handleMouseUp))}),c.appendChild(d),c.appendChild(u),document.querySelector("div.relative.h-full"));((w=(w=w||document.querySelector("div.flex-1.h-full"))||document.querySelector("div.relative"))||document.body).appendChild(c),setWindowIcon(a,fndeskMP3_ico),activeWindows[a]={type:"mp3",url:"/MP3go/index.html",title:fndeskMP3_name,inTray:!1,element:c}}function openMP3PlayerInNewWindow(e){e.preventDefault();window.open("/MP3go/player.html","MP3Player","width=460,height=960,toolbar=no,menubar=no,location=no,status=no,resizable=no,scrollbars=no")}function openUrlInWindow(y,t,e,n=null){for(let e in activeWindows){var i,o=activeWindows[e];if("url"===o.type&&o.url===y&&(null===n||o.iconId===n))return i=document.getElementById(e),void(o.inTray?restoreFromTray(e):i&&(addToTray(e,t,i),o.inTray=!0,i.style.display="none",currentActiveWindowId===e)&&(currentActiveWindowId=null))}let a,l=(a=n?"url-window-"+n+"-"+Date.now()+"-"+Math.floor(1e3*Math.random()):"url-window-"+Date.now()+"-"+Math.floor(1e3*Math.random()),800),r=600,s=null,d=null;try{var c=y.replace(/[^a-z0-9]/gi,"_").substring(0,100),p=localStorage.getItem("url-window-state-"+c);if(p){let{width:e,height:t,left:n,top:i}=JSON.parse(p);400<=e&&e<=window.innerWidth&&300<=t&&t<=window.innerHeight&&(l=e,r=t),void 0!==n&&void 0!==i&&(s=n,d=i)}}catch(e){console.warn("ËØªÂèñÁ™óÂè£Áä∂ÊÄÅÁºìÂ≠òÂ§±Ë¥•:",e)}let u=document.createElement("div");u.id=a,u.style.position="absolute",u.style.background="rgb(241, 244, 249)",u.style.border="1px solid rgb(210, 210, 210)",u.style.borderRadius="10px",u.style.boxShadow="0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05)",u.style.width=l+"px",u.style.height=r+"px",u.style.display="flex",u.style.flexDirection="column",currentZIndex++,u.style.zIndex=currentZIndex,u.style.backdropFilter="blur(10px)",u.addEventListener("mousedown",function(e){W||_||(currentZIndex++,u.style.zIndex=currentZIndex,currentActiveWindowId=a,u.dataset.hasFocus="true")});c=window.innerWidth,p=window.innerHeight;let m=null!==s?s:(c-l)/2,f=null!==d?d:(p-r)/2;m=Math.max(20,Math.min(m,c-l-20)),f=Math.max(20,Math.min(f,p-r-20)),u.style.left=m+"px",u.style.top=f+"px";c=document.createElement("div"),c.style.height="40px",c.style.background="rgb(241, 244, 249)",c.style.borderTopLeftRadius="8px",c.style.borderTopRightRadius="8px",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="space-between",c.style.padding="0 10px",c.style.cursor="move",p=document.createElement("div");p.style.display="flex",p.style.alignItems="center",p.style.gap="8px";let h="deskdata/img/i.png";try{e&&"string"==typeof e&&""!==e.trim()?h=e.trim():getIconForUrl(y)&&(h=getIconForUrl(y)),h}catch(e){console.error("ÂõæÊ†áURLÂ§ÑÁêÜÂá∫Èîô:",e),h="deskdata/img/i.png"}function vb(e){console.error("‚ùå iframeÁ™óÂè£ÂõæÊ†áÂä†ËΩΩÂ§±Ë¥•:",h),console.error("ÈîôËØØ‰∫ã‰ª∂:",e.type,e);try{g.removeEventListener("error",vb),this.src="deskdata/img/i.png",setWindowIcon(a,"deskdata/img/i.png")}catch(e){console.error("ËÆæÁΩÆÈªòËÆ§ÂõæÊ†á‰πüÂ§±Ë¥•:",e)}}let g=document.createElement("img");g.id="window-icon-"+a,g.alt=`${t||"ÁΩëÈ°µÊü•Áúã"} - Á™óÂè£ÂõæÊ†á`,g.src=h,g.style.cssText=`
    width: 20px !important;
    height: 20px !important;
    object-fit: contain !important;
    display: inline-block !important;
    visibility: visible !important;
    opacity: 1 !important;
    margin-right: 5px !important;
    border: none !important;
    background: none !important;
    z-index: 9999 !important;
    position: relative !important;
  `,setWindowIcon(a,h),g.addEventListener("load",function(){this.style.display="inline-block",this.style.visibility="visible",this.style.opacity="1"});g.addEventListener("error",vb),setTimeout(()=>{var e=document.getElementById("window-icon-"+a);e?(e.style.display="none",e.offsetWidth,e.style.display="inline-block"):console.warn("ÂõæÊ†áÂÖÉÁ¥†Êú™Âú®DOM‰∏≠ÊâæÂà∞")},100);e=document.createElement("div"),e.style.color="#333333",e.style.fontSize="14px",e.style.fontWeight="bold",e.textContent=t||"ÁΩëÈ°µÊü•Áúã",p.appendChild(g),p.appendChild(e),e=document.createElement("div");function createWindowButton(e,t="",n="normal"){let i=document.createElement("div");return i.title=t,i.style.width="40px",i.style.height="40px",i.style.borderRadius="4px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.color="black",i.style.fontSize="18px",i.style.fontWeight=n,i.style.cursor="pointer",i.style.marginRight="2px",i.style.transition="background-color 0.2s ease",i.innerText=e,i.addEventListener("mouseenter",function(){"√ó"===e?(i.style.background="#ff4d4f",i.style.color="white"):i.style.background="#e0e0e0"}),i.addEventListener("mouseleave",function(){i.style.background="transparent",i.style.color="black"}),i}e.style.display="flex",e.style.alignItems="center";var x=createWindowButton("‚Üª","Âà∑Êñ∞È°µÈù¢"),v=(x.addEventListener("click",function(e){e.stopPropagation(),E.style.display="block",b.src=b.src}),createWindowButton("‚àí","ÊúÄÂ∞èÂåñ","bold"));v.addEventListener("click",function(e){e.stopPropagation(),initializeTraySystem(),ensureTrayExists(),addToTray(a,t||"ÁΩëÈ°µÊü•Áúã",u),u.style.display="none",activeWindows[a]&&(activeWindows[a].inTray=!0)});let w=createWindowButton("√ó","ÂÖ≥Èó≠","bold");w.addEventListener("click",function(){if(!z.isMaximized)try{var e,t=parseInt(u.style.width),n=parseInt(u.style.height),i=parseInt(u.style.left),o=parseInt(u.style.top);isNaN(t)||isNaN(n)||isNaN(i)||isNaN(o)||(e=y.replace(/[^a-z0-9]/gi,"_").substring(0,100),localStorage.setItem("url-window-state-"+e,JSON.stringify({width:t,height:n,left:i,top:o})))}catch(e){console.warn("‰øùÂ≠òÁ™óÂè£Áä∂ÊÄÅÂ§±Ë¥•:",e)}L&&clearInterval(L),delete activeWindows[a],removeFromTray(a),u.parentNode&&u.parentNode.removeChild(u)}),e.style.display="flex",e.style.alignItems="center",e.appendChild(x),e.appendChild(v),e.appendChild(w),c.appendChild(p),c.appendChild(e);x=document.createElement("div");x.style.flex="1",x.style.position="relative";let b=document.createElement("iframe"),E=(b.src=y,b.style.width="100%",b.style.height="100%",b.style.border="none",b.style.borderRadius="0 0 10px 10px",b.style.backgroundColor="white",document.createElement("div")),I=(E.style.position="absolute",E.style.top="50%",E.style.left="50%",E.style.transform="translate(-50%, -50%)",E.style.background="rgba(0, 0, 0, 0.7)",E.style.color="white",E.style.padding="10px 20px",E.style.borderRadius="5px",E.style.zIndex="10",E.textContent="Âä†ËΩΩ‰∏≠...",x.appendChild(b),x.appendChild(E),b.addEventListener("load",function(){E.style.display="none"}),Date.now()),L,C=(b.addEventListener("load",function(){E.style.display="none";try{b.contentWindow&&b.contentWindow.document&&(b.contentWindow.document.addEventListener("click",function(){currentZIndex++,u.style.zIndex=currentZIndex,I=Date.now()}),b.contentWindow.document.addEventListener("mousedown",function(){currentZIndex++,u.style.zIndex=currentZIndex,I=Date.now()}))}catch(e){}L=L||setInterval(function(){try{(document.activeElement===b||b.contentWindow&&document.activeElement===b.contentWindow.document.activeElement)&&(I=Date.now(),currentZIndex++,u.style.zIndex=currentZIndex)}catch(e){}},200)}),b.setAttribute("tabindex","-1"),b.addEventListener("mousedown",function(){currentZIndex++,u.style.zIndex=currentZIndex,I=Date.now()}),document.createElement("div")),k=(C.style.position="absolute",C.style.bottom="0",C.style.right="0",C.style.width="30px",C.style.height="30px",C.style.cursor="se-resize",C.style.background="rgba(66, 153, 225, 0.3)",C.style.borderTop="1px solid rgba(66, 153, 225, 0.5)",C.style.borderLeft="1px solid rgba(66, 153, 225, 0.5)",C.style.borderRadius="4px 0 0 0",C.style.boxShadow="0 0 8px rgba(66, 153, 225, 0.8)",C.style.zIndex="100",u.appendChild(c),u.appendChild(x),u.appendChild(C),document.querySelector("div.relative.h-full")),W=(((k=(k=k||document.querySelector("div.flex-1.h-full"))||document.querySelector("div.relative"))||document.body).appendChild(u),!(activeWindows[a]={id:a,type:"url",url:y,title:t||"ÁΩëÈ°µÊü•Áúã",iconId:n,element:u,inTray:!1})),M,T,_=!1,z={isMaximized:!1,originalWidth:l,originalHeight:r,originalLeft:m,originalTop:f};function handleMouseMove(e){var t,n,i,o;W&&(o=e.clientX-M,e=e.clientY-T,t=window.innerWidth,i=window.innerHeight,n=u.offsetWidth,i=i-u.offsetHeight,o=Math.max(65,Math.min(o,t-n)),e=Math.max(0,Math.min(e,i)),u.style.left=o+"px",u.style.top=e+"px")}function handleMouseUp(){if(W&&(W=!1,document.body.style.cursor="",document.body.style.overflow="",b&&(b.style.pointerEvents="auto"),document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("mouseup",handleMouseUp),document.removeEventListener("mouseleave",handleMouseUp),!z.isMaximized)){var e=parseInt(u.style.left),t=parseInt(u.style.top);z.originalLeft=e,z.originalTop=t;try{var n,i=parseInt(u.style.width),o=parseInt(u.style.height);isNaN(i)||isNaN(o)||isNaN(e)||isNaN(t)||(n=y.replace(/[^a-z0-9]/gi,"_").substring(0,100),localStorage.setItem("url-window-state-"+n,JSON.stringify({width:i,height:o,left:e,top:t})))}catch(e){console.warn("‰øùÂ≠òÁ™óÂè£‰ΩçÁΩÆÂ§±Ë¥•:",e)}}}c.addEventListener("mousedown",function(e){var t;e.target!==w&&e.target!==C&&(W=!0,t=u.getBoundingClientRect(),M=e.clientX-t.left,T=e.clientY-t.top,currentZIndex++,u.style.zIndex=currentZIndex,document.body.style.cursor="move",document.body.style.overflow="hidden",b&&(b.style.pointerEvents="none"),document.addEventListener("mousemove",handleMouseMove),document.addEventListener("mouseup",handleMouseUp),document.addEventListener("mouseleave",handleMouseUp))}),c.addEventListener("dblclick",function(e){var t;e.target!==w&&(e=window.innerWidth,t=window.innerHeight,z.isMaximized?(z.isMaximized=!1,u.style.left=z.originalLeft+"px",u.style.top=z.originalTop+"px",u.style.width=z.originalWidth+"px",u.style.height=z.originalHeight+"px"):(z.isMaximized=!0,z.originalWidth=parseInt(u.style.width),z.originalHeight=parseInt(u.style.height),z.originalLeft=parseInt(u.style.left),z.originalTop=parseInt(u.style.top),u.style.left="65px",u.style.top="0px",u.style.width=e-65+"px",u.style.height=t+"px"))}),C.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault(),_=!0,z.isMaximized&&(z.isMaximized=!1,u.style.left=z.originalLeft+"px",u.style.top=z.originalTop+"px",u.style.width=z.originalWidth+"px",u.style.height=z.originalHeight+"px"),currentZIndex++,u.style.zIndex=currentZIndex;let a=e.clientX,l=e.clientY,r=u.offsetWidth,s=u.offsetHeight,d=400,c=300;function resize(e){var t=r+(e.clientX-a),e=s+(e.clientY-l),t=Math.max(t,d),e=Math.max(e,c),n=window.innerWidth,i=window.innerHeight,o=parseInt(u.style.left)||0,i=i-(parseInt(u.style.top)||0)-10;t=Math.min(t,n-o-10),e=Math.min(e,i),t=Math.max(t,d),e=Math.max(e,c),u.style.width=t+"px",u.style.height=e+"px"}function stopResize(){if(document.removeEventListener("mousemove",resize),document.removeEventListener("mouseup",stopResize),document.removeEventListener("mouseleave",stopResize),!z.isMaximized)try{var e,t=parseInt(u.style.width),n=parseInt(u.style.height),i=parseInt(u.style.left),o=parseInt(u.style.top);isNaN(t)||isNaN(n)||(z.originalWidth=t,z.originalHeight=n),isNaN(t)||isNaN(n)||isNaN(i)||isNaN(o)||(e=y.replace(/[^a-z0-9]/gi,"_").substring(0,100),localStorage.setItem("url-window-state-"+e,JSON.stringify({width:t,height:n,left:i,top:o})))}catch(e){console.warn("‰øùÂ≠òÁ™óÂè£Áä∂ÊÄÅÂ§±Ë¥•:",e)}b&&(b.style.pointerEvents="auto"),document.body.style.cursor="",document.body.style.overflow="",_=!1}b&&(b.style.pointerEvents="none"),document.body.style.cursor="se-resize",document.body.style.overflow="hidden",document.addEventListener("mousemove",resize),document.addEventListener("mouseup",stopResize),document.addEventListener("mouseleave",stopResize)})}function showContextMenu(e,s){e.preventDefault();let t=["fndata_Lan","fndata_Wan","fndata_URL1","fndata_URL2","fndata_URL3"],n=!1;for(let e=0;e<t.length;e++){var i=s[t[e]];if(i&&i.trim()){n=!0;break}}let o=[];n?["ÂÜÖÁΩëURL ","ÂÖ¨ÁΩëURL ","Â§áÁî®  1","Â§áÁî®  2","Â§áÁî®  3"].forEach((l,e)=>{let r=s[t[e]];r&&r.trim()&&o.push({text:l,onClick:()=>{},customContent:e=>{Object.assign(e.style,{cursor:"default",justifyContent:"space-between"}),e.innerHTML="";let t=document.createElement("div");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.bottom="0",t.style.width="3px",t.style.background="#4299e1",t.style.boxShadow="0 0 10px #4299e1",t.style.opacity="0",t.style.transition="opacity 0.2s ease",e.appendChild(t);var n=document.createElement("span"),n=(n.style.marginLeft="5px",n.style.marginRight="5px",n.textContent=l,e.appendChild(n),document.createElement("div")),i=(n.style.display="flex",n.style.gap="8px",document.createElement("button")),o=(i.style.background="rgba(66, 153, 225, 0.3)",i.style.border="1px solid #4299e1",i.style.borderRadius="4px",i.style.color="#ffffff",i.style.fontSize="13px",i.style.padding="4px 6px",i.style.cursor="pointer",i.style.transition="all 0.2s ease",i.textContent="Êñ∞Á™ó",i.title="Âú®Êñ∞Á™óÂè£ÊâìÂºÄÈìæÊé•",i.addEventListener("click",function(e){e.stopPropagation();e=processUrlField(r),window.open(e,"_blank"),e=document.getElementById("tech-context-menu");e&&(e.style.display="none")}),document.createElement("button")),a=(o.style.background="rgba(66, 153, 225, 0.3)",o.style.border="1px solid #4299e1",o.style.borderRadius="4px",o.style.color="#ffffff",o.style.fontSize="13px",o.style.padding="4px 6px",o.style.cursor="pointer",o.style.transition="all 0.2s ease",o.textContent="È°µÂÜÖ",o.title="Âú®Êú¨È°µÈù¢ÂÜÖÊâìÂºÄÈìæÊé•",o.addEventListener("click",function(e){e.stopPropagation();let t="";s.fndata_LanPic&&"string"==typeof s.fndata_LanPic&&""!==s.fndata_LanPic.trim()?t=s.fndata_LanPic.trim():s["ÂõæÁâáURL"]&&"string"==typeof s["ÂõæÁâáURL"]&&""!==s["ÂõæÁâáURL"].trim()&&(t=s["ÂõæÁâáURL"].trim());openUrlInWindow(processUrlField(r),s.fndata_Title+" - "+l,t,s.id);e=document.getElementById("tech-context-menu");e&&(e.style.display="none")}),e=>{e.addEventListener("mouseenter",function(){this.style.background="rgba(66, 153, 225, 0.5)",this.style.transform="scale(1.05)"}),e.addEventListener("mouseleave",function(){this.style.background="rgba(66, 153, 225, 0.3)",this.style.transform="scale(1)"})});a(i),a(o),n.appendChild(i),n.appendChild(o),e.appendChild(n),e.addEventListener("mouseenter",function(){this.style.background="rgba(66, 153, 225, 0.2)",t.style.opacity="1",this.style.color="#ffffff"}),e.addEventListener("mouseleave",function(){this.style.background="transparent",t.style.opacity="0",this.style.color="#e0e0ff"})}})}):o.push({text:"Ê≤°ÊúâËÆæÁΩÆËøûÊé•",style:{color:"#999999",cursor:"default",textAlign:"center"}}),showCustomContextMenu(e,o)}function findTargetElement(){var e=document.querySelectorAll(".box-border.flex.size-full.flex-col.flex-wrap.place-content-start.items-start.py-base-loose");return 0<e.length?e[e.length-1]:null}function processData(){if(globalData){var e=document.getElementById("LoginBeian");e&&e.remove(),fetch("deskdata/fnstyle.json?v="+(new Date).getTime()).then(e=>e.json()).then(i=>{if(i.desktopWallpaper&&"/static/bg/wallpaper-1.webp"!==i.desktopWallpaper){let n=setInterval(()=>{var e=document.querySelectorAll(".object-contain");let t=!1;e.forEach(e=>{e=e.querySelector("img");e&&(e.src=i.desktopWallpaper+"?v="+Date.now(),t=!0)}),t&&clearInterval(n)},100)}}).catch(e=>console.error("ËØªÂèñfnstyle.jsonÂ§±Ë¥•:",e)),!function hidden_fndesk_ser(){document.querySelectorAll(".text-base").forEach(e=>{"fndeskÊúçÂä°"===e.title&&(e=e.parentElement?.parentElement)&&(e.style.display="none")})}(),fetch("deskdata/fnstyle.json?v="+(new Date).getTime()).then(e=>e.json()).then(e=>{e.sysicoDisplay&&e.sysicoDisplay.split(/[,Ôºå]/).map(e=>e.trim()).filter(e=>e).forEach(t=>{document.querySelectorAll(".text-base").forEach(e=>{e.title===t&&(e=e.parentElement?.parentElement)&&(e.style.display="none")})})}).catch(e=>console.error("ËØªÂèñfnstyle.jsonÂ§±Ë¥•:",e));document.querySelectorAll(".text-base").forEach(e=>{"Â∫îÁî®‰∏≠ÂøÉ"===e.title&&(e=e.parentElement?.parentElement)&&e.addEventListener("contextmenu",function(e){showCustomContextMenu(e,[{text:"ÊâìÂºÄ FnDepot",onClick:()=>{openUrlInWindow(window.location.href+"/cgi/ThirdParty/fndepot/index.cgi/","FnDepot","app-center-static/serviceicon/fndepot/ui/images/icon_%7B0%7D.png?size=256","fndepot")}}])})}),document.addEventListener("mousedown",function(e){0===e.button?1!=fndeskClickSound&&3!=fndeskClickSound||playSound("click.mp3"):2!==e.button||2!=fndeskClickSound&&3!=fndeskClickSound||playSound("right.mp3")},!0);var t,n,i,e=document.querySelector(".flex.flex-col.items-center.justify-between"),o=(e&&fndeskMP3_url&&""!==fndeskMP3_url&&((t=document.createElement("div")).setAttribute("aria-expanded","false"),t.setAttribute("aria-haspopup","dialog"),t.setAttribute("class",""),t.setAttribute("tabindex","0"),t.setAttribute("aria-controls","5p4wiy0"),t.setAttribute("data-popupid","5p4wiy0"),t.style.display="inline-block",t.title="üéµ Fndesk Èü≥‰πêÊí≠ÊîæÂô®",(n=document.createElement("div")).className="w-full flex items-center justify-center cursor-pointer h-5",(i=document.createElement("div")).className="flex justify-center items-center h-5 w-full",i.setAttribute("tabindex","0"),i.setAttribute("aria-describedby","5p4wiy0"),i.setAttribute("data-popupid","5p4wiy0"),(o=document.createElement("img")).src="/MP3go/css/images/mp3.png",o.className="hover:text-white cursor-pointer px-tight text-[20px] h-base-loose block text-white-80",o.style.width="20px",o.style.height="20px",o.style.objectFit="contain",t.addEventListener("click",openMP3Player),t.addEventListener("contextmenu",openMP3PlayerInNewWindow),i.appendChild(o),n.appendChild(i),t.appendChild(n),e.insertBefore(t,e.firstChild)),globalData.filter(e=>0===e.fndata_For).sort((e,t)=>1===iconSort?e.fndata_Sort-t.fndata_Sort:t.fndata_Sort-e.fndata_Sort));let l=findTargetElement();function playSound(e){new Audio("deskdata/"+e).play().catch(e=>console.error("Èü≥È¢ëÊí≠ÊîæÂ§±Ë¥•:",e))}l?(o.forEach(n=>{var e,t,i,o,a;0!==n.enable&&((e=document.createElement("div")).className="flex h-[124px] w-[130px] cursor-pointer flex-col items-center justify-center gap-4",e.addEventListener("click",async function(){if(1===n.fndata_Type)openFolderWindow(n,globalData);else{let t=null;var e;if(optimizedUrls.has(n.id))t=optimizedUrls.get(n.id);else if(n.fndata_Wan&&n.fndata_Wan.trim()?t=processUrlField(n.fndata_Wan):n.fndata_Lan&&n.fndata_Lan.trim()&&(t=processUrlField(n.fndata_Lan)),!t)for(e of[processUrlField(n.fndata_URL1),processUrlField(n.fndata_URL2),processUrlField(n.fndata_URL3)])if(e&&e.trim()){t=e;break}if(t)if(1===n.OpenInPage){let e="";n.fndata_LanPic&&"string"==typeof n.fndata_LanPic&&""!==n.fndata_LanPic.trim()?e=n.fndata_LanPic.trim():n["ÂõæÁâáURL"]&&"string"==typeof n["ÂõæÁâáURL"]&&""!==n["ÂõæÁâáURL"].trim()&&(e=n["ÂõæÁâáURL"].trim()),openUrlInWindow(t,n.fndata_Title,e,n.id)}else window.open(t,"_blank")}}),e.addEventListener("contextmenu",function(e){1===n.fndata_Type?showFolderContextMenu(e,n,globalData):showContextMenu(e,n)}),(t=document.createElement("div")).className="flex shrink-0 flex-row items-center overflow-hidden",(i=document.createElement("div")).className="size-[80px] p-[15%] box-border !h-[50px] !w-[50px] !p-0",(a=document.createElement("div")).className="semi-image size-full",(o=document.createElement("img")).src=n.fndata_LanPic||n["ÂõæÁâáURL"],o.dataSrc=n.fndata_LanPic||n["ÂõæÁâáURL"],o.alt=n.fndata_Title,o.className="semi-image-img w-full h-full !rounded-[10%]",o.style.userSelect="none",o.style.pointerEvents="none",a.appendChild(o),i.appendChild(a),t.appendChild(i),(o=document.createElement("div")).className="flex h-base-loose shrink-0 items-center justify-center gap-x-2.5 self-stretch px-2.5",(a=document.createElement("div")).className="line-clamp-1 max-w-[112px] shrink-0 whitespace-normal text-center align-top text-base font-bold leading-5 text-white",a.textContent=n.fndata_Title,a.style.textShadow="rgba(0, 0, 0, 0.2) 0px 1px 6px, rgba(0, 0, 0, 0.5) 0px 0px 4px",o.appendChild(a),e.appendChild(t),e.appendChild(o),l.appendChild(e))}),console.log(`ÊàêÂäüÊ∑ªÂä†‰∫Ü ${o.length} ‰∏™ÂΩíÂ±û‰∏∫Ê°åÈù¢ÁöÑËÆ∞ÂΩï`)):console.error("Êú™ÊâæÂà∞ÁõÆÊ†ádivÂÖÉÁ¥†")}else console.error("Êï∞ÊçÆÊú™Âä†ËΩΩÔºåÊó†Ê≥ïÂ§ÑÁêÜ")}async function optimizeUrls(e){e=e.filter(e=>0===e.fndata_Type).map(async t=>{try{let e=null;var n,i;if(t.fndata_Wan&&t.fndata_Wan.trim()&&(e=processUrlField(t.fndata_Wan)),!(e=t.fndata_Lan&&t.fndata_Lan.trim()&&await ping(n=processUrlField(t.fndata_Lan))?n:e))for(i of[processUrlField(t.fndata_URL1),processUrlField(t.fndata_URL2),processUrlField(t.fndata_URL3)])if(i&&i.trim()){e=i;break}e&&optimizedUrls.set(t.id,e)}catch(e){console.warn(`‰ºòÂåñURLÊó∂Âá∫Èîô (ID: ${t.id}):`,e)}});await Promise.all(e),pingCompleted=!0,console.log(`URL‰ºòÂåñÂÆåÊàêÔºåÂÖ±‰ºòÂåñ ${optimizedUrls.size} ‰∏™ÈìæÊé•`)}function initWithRetry(){findTargetElement()?(clearInterval(intervalnasNameDisplay),processData(),globalData&&!pingCompleted&&optimizeUrls(globalData).catch(e=>{console.error("URL‰ºòÂåñËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:",e)})):retryCount<maxRetries?(retryCount++,setTimeout(initWithRetry,retryInterval)):console.error("Ë∂ÖËøáÊúÄÂ§ßÈáçËØïÊ¨°Êï∞Ôºà"+maxRetries+"Ê¨°ÔºâÔºå‰ªçÊú™ÊâæÂà∞ÁõÆÊ†ádiv")}function ping(o,a=2e3){let l=Date.now();return new Promise(i=>{var e="https:"===window.location.protocol,t=o.startsWith("http:");if(e&&t){let e=new XMLHttpRequest,t=setTimeout(()=>{e.abort(),i(!1)},a);e.onload=()=>{clearTimeout(t),i(!0)},e.onerror=()=>{clearTimeout(t),isInternalIp(o)?i(!0):i(!1)},e.ontimeout=()=>{clearTimeout(t),i(!1)};try{e.open("HEAD",o+"?"+Date.now(),!0),e.timeout=a,e.send()}catch(e){clearTimeout(t),i(!1)}}else{let e=new AbortController,n=setTimeout(()=>{e.abort()},a);fetch(o,{method:"HEAD",mode:"no-cors",signal:e.signal}).then(()=>{clearTimeout(n);Date.now(),l;i(!0)}).catch(e=>{clearTimeout(n);var t=Date.now()-l;"TypeError"===e.name||"AbortError"===e.name?fallbackWithXHR(o,a-t).then(e=>i(e)):i(!1)})}})}function fallbackWithXHR(i,o){return new Promise(t=>{let e=new XMLHttpRequest,n=setTimeout(()=>{e.abort(),t(!1)},0<o?o:1e3);e.onload=()=>{clearTimeout(n),t(!0)},e.onerror=()=>{clearTimeout(n),isInternalIp(i)?t(!0):t(!1)},e.ontimeout=()=>{clearTimeout(n),t(!1)};try{e.open("HEAD",i+"&fallback="+Date.now(),!0),e.timeout=0<o?o:1e3,e.send()}catch(e){clearTimeout(n),isInternalIp(i)?t(!0):t(!1)}})}function openFolderWindow(o,t){let n="folder-window-"+o.id;for(var e in currentActiveWindowId=n,activeWindows){var i=activeWindows[e];if("folder"===i.type&&i.folderId===o.id)return void(i.inTray?restoreFromTray(e):(i=document.getElementById(e))&&("none"===i.style.display?(i.style.display="flex",currentActiveWindowId=e,currentZIndex++,i.style.zIndex=currentZIndex):(initializeTraySystem(),ensureTrayExists(),addToTray(e,o.fndata_Title,i),i.style.display="none",activeWindows[e].inTray=!0)))}let a=500,l=500,r=null,s=null;try{var d=localStorage.getItem("folder-window-state-"+o.id);if(d){let{width:e,height:t,left:n,top:i}=JSON.parse(d);300<=e&&e<=window.innerWidth&&150<=t&&t<=window.innerHeight&&(a=e,l=t),void 0!==n&&void 0!==i&&(r=n,s=i)}}catch(e){console.warn("ËØªÂèñÁ™óÂè£Áä∂ÊÄÅÁºìÂ≠òÂ§±Ë¥•:",e)}let p=document.createElement("div");p.id=n,p.style.position="fixed",p.style.background="rgba(255, 255, 255, 1)",p.style.border="1px solid rgb(210, 210, 210)",p.style.borderRadius="10px",p.style.boxShadow="0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05)",p.style.width=a+"px",p.style.height=l+"px",p.style.display="flex",p.style.flexDirection="column",currentZIndex++,p.style.zIndex=currentZIndex,p.style.backdropFilter="blur(10px)",p.addEventListener("mousedown",function(e){b||L||(currentZIndex++,p.style.zIndex=currentZIndex)});var d=window.innerWidth,c=window.innerHeight;let y=null!==r?r:(d-a)/2,u=null!==s?s:(c-l)/2;y=Math.max(20,Math.min(y,d-a-20)),u=Math.max(20,Math.min(u,c-l-20)),p.style.left=y+"px",p.style.top=u+"px";var d=document.createElement("div"),c=(d.style.height="40px",d.style.background="rgb(241, 244, 249)",d.style.borderTopLeftRadius="8px",d.style.borderTopRightRadius="8px",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="space-between",d.style.padding="0 10px",d.style.cursor="move",d.style.display="flex",d.style.justifyContent="space-between",d.style.alignItems="center",document.createElement("div")),m=(c.style.color="#333333",c.style.fontSize="14px",c.style.fontWeight="bold",c.textContent=o.fndata_Title,document.createElement("div"));m.style.display="flex",m.style.alignItems="center";let f="deskdata/img/i.png";try{o.fndata_LanPic&&"string"==typeof o.fndata_LanPic&&""!==o.fndata_LanPic.trim()?f=o.fndata_LanPic.trim():o["ÂõæÁâáURL"]&&"string"==typeof o["ÂõæÁâáURL"]&&""!==o["ÂõæÁâáURL"].trim()&&(f=o["ÂõæÁâáURL"].trim()),f}catch(e){console.error("ÂõæÊ†áURLÂ§ÑÁêÜÂá∫Èîô:",e),f="deskdata/img/i.png"}var h=document.createElement("img");for(h.id="window-icon-"+n,h.alt=o.fndata_Title+" - Á™óÂè£ÂõæÊ†á",h.src=f,h.style.cssText=`
    width: 20px !important;
    height: 20px !important;
    margin-right: 8px !important;
    object-fit: contain !important;
    border: none !important;
    background: none !important;
    display: inline-block !important;
    visibility: visible !important;
    opacity: 1 !important;
    z-index: 9999 !important;
    position: relative !important;
    pointer-events: auto !important;
  `,setWindowIcon(n,f),h.addEventListener("load",function(){this.style.display="inline-block",this.style.visibility="visible",this.style.opacity="1"}),h.addEventListener("error",function(e){console.error("‚ùå ÂõæÊ†áÂä†ËΩΩÂ§±Ë¥•:",f),console.error("ÈîôËØØ‰∫ã‰ª∂:",e.type,e);try{this.src="deskdata/img/i.png",setWindowIcon(n,"deskdata/img/i.png")}catch(e){console.error("ËÆæÁΩÆÈªòËÆ§ÂõæÊ†á‰πüÂ§±Ë¥•:",e)}});m.firstChild;)m.removeChild(m.firstChild);m.appendChild(h),m.appendChild(c),setTimeout(()=>{var e=document.getElementById("window-icon-"+n);e?(e.style.display="inline-block",e.style.visibility="visible",e.style.opacity="1",e.offsetHeight):console.error("ÂõæÊ†áÂÖÉÁ¥†Êú™Âú®DOM‰∏≠ÊâæÂà∞")},100);{function createWindowButton(e,t="",n="normal"){let i=document.createElement("div");return i.title=t,i.style.width="40px",i.style.height="40px",i.style.borderRadius="4px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.color="black",i.style.fontSize="18px",i.style.fontWeight=n,i.style.cursor="pointer",i.style.marginRight="2px",i.style.transition="background-color 0.2s ease",i.innerText=e,i.addEventListener("mouseenter",function(){"√ó"===e?(i.style.background="#ff4d4f",i.style.color="white"):i.style.background="#e0e0e0"}),i.addEventListener("mouseleave",function(){i.style.background="transparent",i.style.color="black"}),i}}h=createWindowButton("‚àí","ÊúÄÂ∞èÂåñ","bold");h.addEventListener("click",function(e){e.stopPropagation(),initializeTraySystem(),ensureTrayExists(),addToTray(n,o.fndata_Title,p),p.style.display="none",activeWindows[n]&&(activeWindows[n].inTray=!0)});let g=createWindowButton("√ó","ÂÖ≥Èó≠","bold");g.addEventListener("click",function(){p.style.display="none",activeWindows[n]&&(activeWindows[n].inTray=!1)});c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.appendChild(h),c.appendChild(g),d.appendChild(m),d.appendChild(c);let x=document.createElement("div"),v=(x.style.flex="1",x.style.padding="15px",x.style.overflow="auto",x.style.display="grid",x.style.gridTemplateColumns="repeat(auto-fill, 100px)",x.style.gridAutoRows="110px",x.style.gap="10px",x.style.justifyContent="start",x.style.alignContent="start",x.addEventListener("click",function(){currentZIndex++,p.style.zIndex=currentZIndex}),x.addEventListener("mousedown",function(){currentZIndex++,p.style.zIndex=currentZIndex}),document.createElement("div")),w=(v.style.position="absolute",v.style.bottom="0",v.style.right="0",v.style.width="30px",v.style.height="30px",v.style.cursor="se-resize",v.style.background="rgba(66, 153, 225, 0.3)",v.style.borderTop="1px solid rgba(66, 153, 225, 0.5)",v.style.borderLeft="1px solid rgba(66, 153, 225, 0.5)",v.style.borderRadius="4px 0 0 0",v.style.boxShadow="0 0 8px rgba(66, 153, 225, 0.8)",v.style.zIndex="100",v.style.pointerEvents="all",p.appendChild(d),p.appendChild(x),p.appendChild(v),document.querySelector("div.relative.h-full")),b=(((w=(w=w||document.querySelector("div.flex-1.h-full"))||document.querySelector("div.relative"))||document.body).appendChild(p),activeWindows[n]={id:n,type:"folder",folderId:o.id,title:o.fndata_Title,element:p,inTray:!1},t.filter(e=>e.fndata_For===o.id).sort((e,t)=>1===iconSort?e.fndata_Sort-t.fndata_Sort:t.fndata_Sort-e.fndata_Sort).forEach(e=>{0!==e.enable&&(e=createFolderItemElement(e,t),x.appendChild(e))}),o.fndata_Wan&&""!==o.fndata_Wan.trim()&&o.fndata_Wan.split(/[,Ôºå]/).map(e=>e.trim()).filter(e=>e).forEach(e=>{document.querySelectorAll(".text-base").forEach(n=>{if(n.title===e){let t=n.parentElement?.parentElement;if(t){var i=t.querySelector("img");if(i){let e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.justifyContent="flex-start",e.style.cursor="pointer",e.style.padding="10px 5px 5px 5px",e.style.borderRadius="4px",e.style.transition="background-color 0.2s",e.addEventListener("mouseenter",function(){e.style.background="rgba(255, 255, 255, 0.1)"}),e.addEventListener("mouseleave",function(){e.style.background="transparent"});var o=document.createElement("div"),i=(o.style.width="60px",o.style.height="60px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.marginBottom="5px",i.cloneNode(!0)),i=(i.style.width="100%",i.style.height="100%",i.style.objectFit="contain",i.style.borderRadius="8px",o.appendChild(i),document.createElement("div"));i.style.color="black",i.style.fontSize="14px",i.style.fontWeight="bold",i.style.textAlign="center",i.style.lineHeight="1.2",i.style.maxWidth="120px",i.style.wordBreak="break-word",i.title=n.title,i.textContent=n.textContent,e.appendChild(o),e.appendChild(i),e.addEventListener("click",function(){var e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(e)}),x.appendChild(e),t.style.display="none"}}}})}),!1),E,I,L=!1,C={isMaximized:!1,originalWidth:a,originalHeight:l,originalLeft:y,originalTop:u};function handleMouseMove(e){var t,n,i,o;b&&(o=e.clientX-E,e=e.clientY-I,t=window.innerWidth,i=window.innerHeight,n=p.offsetWidth,i=i-p.offsetHeight,o=Math.max(65,Math.min(o,t-n)),e=Math.max(0,Math.min(e,i)),p.style.left=o+"px",p.style.top=e+"px")}function handleMouseUp(){if(b&&(b=!1,document.body.style.cursor="",document.body.style.overflow="",x&&(x.style.pointerEvents="auto"),document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("mouseup",handleMouseUp),document.removeEventListener("mouseleave",handleMouseUp),!C.isMaximized)){var e=parseInt(p.style.left),t=parseInt(p.style.top);C.originalLeft=e,C.originalTop=t;try{var n=parseInt(p.style.width),i=parseInt(p.style.height);isNaN(n)||isNaN(i)||isNaN(e)||isNaN(t)||localStorage.setItem("folder-window-state-"+o.id,JSON.stringify({width:n,height:i,left:e,top:t}))}catch(e){console.warn("‰øùÂ≠òÁ™óÂè£‰ΩçÁΩÆÂ§±Ë¥•:",e)}}}d.addEventListener("mousedown",function(e){var t;e.target!==g&&e.target!==v&&(b=!0,t=p.getBoundingClientRect(),E=e.clientX-t.left,I=e.clientY-t.top,currentZIndex++,p.style.zIndex=currentZIndex,document.body.style.cursor="move",document.body.style.overflow="hidden",x&&(x.style.pointerEvents="none"),document.addEventListener("mousemove",handleMouseMove),document.addEventListener("mouseup",handleMouseUp),document.addEventListener("mouseleave",handleMouseUp))}),d.addEventListener("dblclick",function(e){var t;e.target!==g&&(e=window.innerWidth,t=window.innerHeight,C.isMaximized?(C.isMaximized=!1,p.style.left=C.originalLeft+"px",p.style.top=C.originalTop+"px",p.style.width=C.originalWidth+"px",p.style.height=C.originalHeight+"px",x.style.width=C.originalWidth-30+"px",x.style.height=C.originalHeight-60+"px"):(C.isMaximized=!0,C.originalWidth=parseInt(p.style.width),C.originalHeight=parseInt(p.style.height),C.originalLeft=parseInt(p.style.left),C.originalTop=parseInt(p.style.top),p.style.left="65px",p.style.top="0px",p.style.width=e-65+"px",p.style.height=t+"px",x.style.width=e-30+"px",x.style.height=t-60+"px"))}),v.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault(),L=!0,C.isMaximized&&(C.isMaximized=!1,p.style.left=C.originalLeft+"px",p.style.top=C.originalTop+"px",p.style.width=C.originalWidth+"px",p.style.height=C.originalHeight+"px",x.style.width=C.originalWidth-30+"px",x.style.height=C.originalHeight-60+"px"),x&&(x.style.pointerEvents="none"),currentZIndex++,p.style.zIndex=currentZIndex;let l=e.clientX,r=e.clientY,s=p.offsetWidth,d=p.offsetHeight,c=320,y=150;function resize(e){var t=s+(e.clientX-l),e=d+(e.clientY-r),t=Math.max(t,c),e=Math.max(e,y),n=window.innerWidth,i=window.innerHeight,o=parseInt(p.style.left)||0,a=parseInt(p.style.top)||0,n=(t=Math.min(t,n-o-10),i-a-10);e=Math.min(e,n),t=Math.max(t,c),e=Math.max(e,y),p.style.width=t+"px",p.style.height=e+"px",x.style.width=t-30+"px",x.style.height=e-60+"px"}function stopResize(){if(document.removeEventListener("mousemove",resize),document.removeEventListener("mouseup",stopResize),document.removeEventListener("mouseleave",stopResize),!C.isMaximized)try{var e=parseInt(p.style.width),t=parseInt(p.style.height);isNaN(e)||isNaN(t)||(localStorage.setItem("folder-window-state-"+o.id,JSON.stringify({width:e,height:t,left:parseInt(p.style.left),top:parseInt(p.style.top)})),C.originalWidth=e,C.originalHeight=t)}catch(e){console.warn("‰øùÂ≠òÁ™óÂè£Â§ßÂ∞èÂ§±Ë¥•:",e)}x&&(x.style.pointerEvents="auto"),document.body.style.cursor="",document.body.style.overflow="",L=!1}document.body.style.cursor="se-resize",document.body.style.overflow="hidden",document.addEventListener("mousemove",resize),document.addEventListener("mouseup",stopResize),document.addEventListener("mouseleave",stopResize)})}function createFolderItemElement(r,t){if(0===r.enable)return document.createElement("div");let e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.justifyContent="flex-start",e.style.cursor="pointer",e.style.padding="10px 5px 5px 5px",e.style.borderRadius="4px",e.style.transition="background-color 0.2s",e.addEventListener("mouseenter",function(){e.style.background="rgba(255, 255, 255, 0.1)"}),e.addEventListener("mouseleave",function(){e.style.background="transparent"});var n=document.createElement("div"),i=(n.style.width="60px",n.style.height="60px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.marginBottom="5px",document.createElement("img")),i=(i.src=r.fndata_LanPic,i.alt=r.fndata_Title,i.style.width="100%",i.style.height="100%",i.style.objectFit="contain",i.style.borderRadius="8px",n.appendChild(i),document.createElement("div"));return i.style.color="black",i.style.fontSize="14px",i.style.fontWeight="bold",i.style.textAlign="center",i.style.lineHeight="1.2",i.style.maxWidth="120px",i.style.wordBreak="break-word",i.title=r.fndata_Title,i.textContent=r.fndata_Title,e.appendChild(n),e.appendChild(i),e.addEventListener("click",function(){if(1===r.fndata_Type)openFolderWindow(r,t);else{let e=null;var o,a=r.fndata_Wan&&r.fndata_Wan.trim(),l=r.fndata_Lan&&r.fndata_Lan.trim();let t="",n=(r.fndata_LanPic&&"string"==typeof r.fndata_LanPic&&""!==r.fndata_LanPic.trim()&&(t=r.fndata_LanPic.trim()),processUrlField(a)),i=processUrlField(l);if(optimizedUrls.has(r.id))e=optimizedUrls.get(r.id),1===r.OpenInPage?openUrlInWindow(e,r.fndata_Title,t,r.id):window.open(e,"_blank");else if(n&&i)1===r.OpenInPage?openUrlInWindow(n,r.fndata_Title,t,r.id):window.open(n,"_blank"),ping(i).then(e=>{e?(optimizedUrls.set(r.id,i),console.log("ÂÜÖÁΩëËøûÊé•Â∑≤Ê£ÄÊµãÂà∞ÂèØËææÔºå‰∏ãÊ¨°ËÆøÈóÆÂ∞Ü‰ΩøÁî®: "+i)):optimizedUrls.set(r.id,n)});else{if(n?e=n:i&&(e=i),!e)for(o of[processUrlField(r.fndata_URL1),processUrlField(r.fndata_URL2),processUrlField(r.fndata_URL3)])if(o&&o.trim()){e=o;break}e&&(optimizedUrls.set(r.id,e),1===r.OpenInPage?openUrlInWindow(e,r.fndata_Title,t,r.id):window.open(e,"_blank"))}}}),e.addEventListener("contextmenu",function(e){0===r.fndata_Type?showContextMenu(e,r):1===r.fndata_Type&&showFolderContextMenu(e,r,t)}),e}function showFolderContextMenu(e,t,n){e.preventDefault(),showCustomContextMenu(e,[{text:"ÊâìÂºÄÊñá‰ª∂Â§π",onClick:()=>{openFolderWindow(t,n)},customContent:e=>{e.innerHTML="";let t=document.createElement("div");t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.bottom="0",t.style.width="3px",t.style.background="#4299e1",t.style.boxShadow="0 0 10px #4299e1",t.style.opacity="0",t.style.transition="opacity 0.2s ease",e.appendChild(t);var n=document.createElement("span");n.style.marginLeft="8px",n.textContent="ÊâìÂºÄÊñá‰ª∂Â§π",e.appendChild(n),e.addEventListener("mouseenter",function(){this.style.background="rgba(66, 153, 225, 0.2)",t.style.opacity="1",this.style.color="#ffffff"}),e.addEventListener("mouseleave",function(){this.style.background="transparent",t.style.opacity="0",this.style.color="#e0e0ff"})}}])}document.addEventListener("DOMContentLoaded",async function(){try{var e=await fetch("deskdata/data.json?v="+(new Date).getTime());if(!e.ok)throw new Error("Failed to fetch data.json");globalData=await e.json(),initWithRetry(),setupSpecificElementsZIndexManagement()}catch(e){console.error("Âä†ËΩΩÊï∞ÊçÆÊó∂ÂèëÁîüÈîôËØØ:",e)}}),window.addEventListener("load",function(){var e=performance.now();console.log(`È°µÈù¢ÂÆåÂÖ®Âä†ËΩΩÊó∂Èó¥: ${e.toFixed(2)}ms`)});